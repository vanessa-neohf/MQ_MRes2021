---
title: "Degree Heating Month Analysis"
author: "Vanessa"
date: "`r lubridate::today()`"
output: pdf_document
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r Loading_Packages, message = FALSE, include = FALSE}
library(tidyverse)
library(lubridate)
library(dplyr)
library(patchwork)
library(colorspace)
library(rmarkdown)
library(tsibble)
library(scales)
library(kableExtra)
```

```{r CCI_Data_with_mmm_from_sst, include = FALSE}

CCI_BRS05 <- read_csv(here::here("data_raw", "CCI_BRS05_with_mmm_and_dhw.csv"))
CCI_BRS07 <- read_csv(here::here("data_raw", "CCI_BRS07_with_mmm_and_dhw.csv"))

CCI_Bundegi <- read_csv(here::here("data_raw", "CCI_Bundegi_with_mmm_and_dhw.csv"))
CCI_Tantabiddi <- read_csv(here::here("data_raw", "CCI_Tantabiddi_with_mmm_and_dhw.csv"))

CCI_DAR3 <- read_csv(here::here("data_raw", "CCI_DAR3_with_mmm_and_dhw.csv"))
CCI_DARL <- read_csv(here::here("data_raw", "CCI_DARL_with_mmm_and_dhw.csv"))

CCI_SCOTT_RPO_1 <- read_csv(here::here("data_raw", "CCI_SCOTT_RPO_1_with_mmm_and_dhw.csv"))
CCI_SCOTT_SL4 <- read_csv(here::here("data_raw", "CCI_SCOTT_SL4_with_mmm_and_dhw.csv"))
CCI_SCOTT_SS3 <- read_csv(here::here("data_raw", "CCI_SCOTT_SS3_with_mmm_and_dhw.csv"))
CCI_SCOTTNR1 <- read_csv(here::here("data_raw", "CCI_SCOTTNR1_with_mmm_and_dhw.csv"))
CCI_SCOTTSL1 <- read_csv(here::here("data_raw", "CCI_SCOTTSL1_with_mmm_and_dhw.csv"))
CCI_SCOTTSL2 <- read_csv(here::here("data_raw", "CCI_SCOTTSL2_with_mmm_and_dhw.csv"))
CCI_SCOTTSL3 <- read_csv(here::here("data_raw", "CCI_SCOTTSL3_with_mmm_and_dhw.csv"))
CCI_SCOTTSS1 <- read_csv(here::here("data_raw", "CCI_SCOTTSS1_with_mmm_and_dhw.csv"))
CCI_SCOTTSS2 <- read_csv(here::here("data_raw", "CCI_SCOTTSS2_with_mmm_and_dhw.csv"))

CCI_HAB05B <- read_csv(here::here("data_raw", "CCI_HAB05B_with_mmm_and_dhw.csv"))
CCI_HAB10A <- read_csv(here::here("data_raw", "CCI_HAB10A_with_mmm_and_dhw.csv"))

```

```{r NOAA_Data_with_mmm_from_sst, include = FALSE}

NOAA_BRS05 <- read_csv(here::here("data_raw", "NOAA_BRS05_with_mmm_and_dhw.csv"))
NOAA_BRS07 <- read_csv(here::here("data_raw", "NOAA_BRS07_with_mmm_and_dhw.csv"))

NOAA_Bundegi <- read_csv(here::here("data_raw", "NOAA_Bundegi_with_mmm_and_dhw.csv"))
NOAA_Tantabiddi <- read_csv(here::here("data_raw", "NOAA_Tantabiddi_with_mmm_and_dhw.csv"))

NOAA_DAR3 <- read_csv(here::here("data_raw", "NOAA_DAR3_with_mmm_and_dhw.csv"))
NOAA_DARL <- read_csv(here::here("data_raw", "NOAA_DAR_Long_with_mmm_and_dhw.csv"))

NOAA_SCOTT_RPO_1 <- read_csv(here::here("data_raw", "NOAA_SCOTT_RPO_1_with_mmm_and_dhw.csv"))
NOAA_SCOTT_SL4 <- read_csv(here::here("data_raw", "NOAA_SCOTT_SL4_with_mmm_and_dhw.csv"))
NOAA_SCOTT_SS3 <- read_csv(here::here("data_raw", "NOAA_SCOTT_SS3_with_mmm_and_dhw.csv"))
NOAA_SCOTTNR1 <- read_csv(here::here("data_raw", "NOAA_SCOTTNR1_with_mmm_and_dhw.csv"))
NOAA_SCOTTSL1 <- read_csv(here::here("data_raw", "NOAA_SCOTTSL1_with_mmm_and_dhw.csv"))
NOAA_SCOTTSL2 <- read_csv(here::here("data_raw", "NOAA_SCOTTSL2_with_mmm_and_dhw.csv"))
NOAA_SCOTTSL3 <- read_csv(here::here("data_raw", "NOAA_SCOTTSL3_with_mmm_and_dhw.csv"))
NOAA_SCOTTSS1 <- read_csv(here::here("data_raw", "NOAA_SCOTTSS1_with_mmm_and_dhw.csv"))
NOAA_SCOTTSS2 <- read_csv(here::here("data_raw", "NOAA_SCOTTSS2_with_mmm_and_dhw.csv"))


NOAA_HAB05B <- read_csv(here::here("data_raw", "NOAA_HAB05B_with_mmm_and_dhw.csv"))
NOAA_HAB10A <- read_csv(here::here("data_raw", "NOAA_HAB10A_with_mmm_and_dhw.csv"))

```

```{r CCore_Calibrated_SST_Data, include = FALSE}

#Coral Core SST data calibrated from CCI data (without mmm)
#DAR3, 13TNT, 08TNT, 13BND, 08BND - will use mmm from CCI satellite data
#exclude d18O coral proxy sites with monthly data - Wallabi Island, TNT
#exclude coral proxy data with annual SST - HAB10A, HAB05B, BUN05A, TNT07C

CCore_BRS05_CCI <- read_csv(here::here("data_raw", "CCore_SST_BRS05_CCI.csv")) %>%
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-14.105", Longitude = "123.5356924", yearmonth = yearmonth(Date), end_date = max(Date), Site = "BRS05")

CCore_BRS07_CCI <- read_csv(here::here("data_raw", "CCore_SST_BRS07_CCI.csv")) %>% 
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-14.121", Longitude = "123.5467277", yearmonth = yearmonth(Date), end_date = max(Date), Site = "BRS07")

CCore_DARL_CCI <- read_csv(here::here("data_raw", "CCore_SST_DARL_CCI.csv")) %>% 
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-12.0875", Longitude = "96.875", yearmonth = yearmonth(Date), end_date = max(Date), Site = "DARL")

CCore_DAR3_CCI <- read_csv(here::here("data_raw", "CCore_SST_DAR3_CCI.csv")) %>% 
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-12.095", Longitude = "96.8805", yearmonth = yearmonth(Date), end_date = max(Date), Site = "DAR3")

CCore_13TNT_CCI <- read_csv(here::here("data_raw", "CCore_SST_Ningaloo_13TNT_CCI.csv")) %>% 
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-21.91", Longitude = "113.97", yearmonth = yearmonth(Date), end_date = max(Date), Site = "13TNT")

CCore_08TNT_CCI <- read_csv(here::here("data_raw", "CCore_SST_Ningaloo_08TNT_CCI.csv")) %>% 
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-21.91", Longitude = "113.97", yearmonth = yearmonth(Date), end_date = max(Date), Site = "08TNT")

CCore_13BND_CCI <- read_csv(here::here("data_raw", "CCore_SST_Ningaloo_13BND_CCI.csv")) %>% 
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-21.87", Longitude = "114.156", yearmonth = yearmonth(Date), end_date = max(Date), Site = "13BND")

CCore_08BND_CCI <- read_csv(here::here("data_raw", "CCore_SST_Ningaloo_08BND_CCI.csv")) %>% 
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-21.87", Longitude = "114.156", yearmonth = yearmonth(Date), end_date = max(Date), Site = "08BND")


#Coral Core SST data calibrated from NOAA data (without mmm)
#DAR3, 13TNT, 08TNT, 13BND, 08BND - will use mmm from NOAA satellite data
#exclude d18O coral proxy sites with monthly data - Wallabi Island, TNT
#exclude coral proxy data with annual SST - HAB10A, HAB05B, BUN05A, TNT07C

CCore_BRS05_NOAA <- read_csv(here::here("data_raw", "CCore_SST_BRS05_NOAA.csv")) %>%
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-14.105", Longitude = "123.5356924", yearmonth = yearmonth(Date), end_date = max(Date), Site = "BRS05")

CCore_BRS07_NOAA <- read_csv(here::here("data_raw", "CCore_SST_BRS07_NOAA.csv")) %>%
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-14.121", Longitude = "123.5467277", yearmonth = yearmonth(Date), end_date = max(Date), Site = "BRS07")

CCore_DARL_NOAA <- read_csv(here::here("data_raw", "CCore_SST_DARL_NOAA.csv")) %>% 
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-12.0875", Longitude = "96.875", yearmonth = yearmonth(Date), end_date = max(Date), Site = "DARL")

CCore_DAR3_NOAA <- read_csv(here::here("data_raw", "CCore_SST_DAR3_NOAA.csv")) %>% 
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-12.095", Longitude = "96.8805", yearmonth = yearmonth(Date), end_date = max(Date), Site = "DAR3")

CCore_13TNT_NOAA <- read_csv(here::here("data_raw", "CCore_SST_Ningaloo_13TNT_NOAA.csv")) %>%
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-21.91", Longitude = "113.97", yearmonth = yearmonth(Date), end_date = max(Date), Site = "13TNT")

CCore_08TNT_NOAA <- read_csv(here::here("data_raw", "CCore_SST_Ningaloo_08TNT_NOAA.csv")) %>%
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-21.91", Longitude = "113.97", yearmonth = yearmonth(Date), end_date = max(Date), Site = "08TNT")

CCore_13BND_NOAA <- read_csv(here::here("data_raw", "CCore_SST_Ningaloo_13BND_NOAA.csv")) %>% 
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-21.87", Longitude = "114.156", yearmonth = yearmonth(Date), end_date = max(Date), Site = "13BND")

CCore_08BND_NOAA <- read_csv(here::here("data_raw", "CCore_SST_Ningaloo_08BND_NOAA.csv")) %>% 
  rename(Date = date) %>% 
  mutate(Date = round_date(Date, unit = "month")) %>% 
  mutate(Latitude = "-21.87", Longitude = "114.156", yearmonth = yearmonth(Date), end_date = max(Date), Site = "08BND")

#annual Coral cores HAB10A, HAB05B, BUN05A, TNT07C
#for date range only
CCore_H_Abrol <- read_csv(here::here("data_raw", "CCore_H_Abrol_SrCa_year.csv"))

CCore_BUN05A <- read_csv(here::here("data_raw", "CCore_Ningaloo_BUN05A_year.csv"))

CCore_TNT07C <- read_csv(here::here("data_raw", "CCore_Ningaloo_TNT07C_year.csv"))



```

```{r GCM_with_mmm_from_sst, include = FALSE}
GCM_BRS05 <- read_csv(here::here("data_raw/GCM", "GCM_BRS05_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_BRS07 <- read_csv(here::here("data_raw/GCM", "GCM_BRS07_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_BUN05A <- read_csv(here::here("data_raw/GCM", "GCM_BUN05A_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_Bundegi <- read_csv(here::here("data_raw/GCM", "GCM_Bundegi_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_DARL <- read_csv(here::here("data_raw/GCM", "GCM_DAR_Long_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_DAR3 <- read_csv(here::here("data_raw/GCM", "GCM_DAR3_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_HAB05B <- read_csv(here::here("data_raw/GCM", "GCM_HAB05B_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_HAB10A <- read_csv(here::here("data_raw/GCM", "GCM_HAB10A_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_SCOTT_RPO_1 <- read_csv(here::here("data_raw/GCM", "GCM_SCOTT_RPO_1_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_SCOTT_SL4 <- read_csv(here::here("data_raw/GCM", "GCM_SCOTT_SL4_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_SCOTT_SS3 <- read_csv(here::here("data_raw/GCM", "GCM_SCOTT_SS3_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_SCOTTNR1 <- read_csv(here::here("data_raw/GCM", "GCM_SCOTTNR1_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_SCOTTSL1 <- read_csv(here::here("data_raw/GCM", "GCM_SCOTTSL1_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_SCOTTSL2 <- read_csv(here::here("data_raw/GCM", "GCM_SCOTTSL2_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_SCOTTSL3 <- read_csv(here::here("data_raw/GCM", "GCM_SCOTTSL3_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_SCOTTSS1 <- read_csv(here::here("data_raw/GCM", "GCM_SCOTTSS1_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_SCOTTSS2 <- read_csv(here::here("data_raw/GCM", "GCM_SCOTTSS2_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_Tantabiddi <- read_csv(here::here("data_raw/GCM", "GCM_Tantabiddi_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

GCM_TNT07C <- read_csv(here::here("data_raw/GCM", "GCM_TNT07C_with_mmm_and_dhw.csv")) %>% 
  rename(Reef_Site = subsite) %>% 
  mutate(Data_Type = "GCM", Year = year(Time), Month = month(Time, label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-"))

```

\newpage
\begin{center}

Date Range of Coral Cores

\end{center}


```{r start_and_end_date_CCore, echo = FALSE, message = FALSE}
Date_BRS05_CCI <- CCore_BRS05_CCI %>% 
  mutate(start_date = year(min(Date)), end_date = year(end_date)) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()
Date_BRS05_NOAA <- CCore_BRS05_NOAA %>% 
  mutate(start_date = year(min(Date)), end_date = year(end_date)) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()

Date_BRS07_CCI <- CCore_BRS07_CCI %>% 
  mutate(start_date = year(min(Date)), end_date = year(end_date)) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()
Date_BRS07_NOAA <- CCore_BRS07_NOAA %>% 
  mutate(start_date = year(min(Date)), end_date = year(end_date)) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()

Date_DAR3_CCI <- CCore_DAR3_CCI %>% 
  mutate(start_date = year(min(Date)), end_date = year(end_date)) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()
Date_DAR3_NOAA <- CCore_DAR3_NOAA %>% 
 mutate(start_date = year(min(Date)), end_date = year(end_date)) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()

Date_DARL_CCI <- CCore_DARL_CCI %>% 
  mutate(start_date = year(min(Date)), end_date = year(end_date)) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()
Date_DARL_NOAA <- CCore_DARL_NOAA %>% 
 mutate(start_date = year(min(Date)), end_date = year(end_date)) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()

Date_13TNT_CCI <- CCore_13TNT_CCI %>% 
  mutate(start_date = year(min(Date)), end_date = year(max(Date)), Site = "13TNT") %>% 
  select(Site, start_date, end_date,) %>% 
  distinct()
Date_13TNT_NOAA <- CCore_13TNT_NOAA %>% 
  mutate(start_date = year(min(Date)), end_date = year(max(Date)), Site = "13TNT") %>% 
  select(Site, start_date, end_date) %>% 
  distinct()

Date_08TNT_CCI <- CCore_08TNT_CCI %>% 
  mutate(start_date = year(min(Date)), end_date = year(max(Date))) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()
Date_08TNT_NOAA <- CCore_08TNT_NOAA %>% 
  mutate(start_date = year(min(Date)), end_date = year(max(Date))) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()

Date_13BND_CCI <- CCore_13BND_CCI %>% 
  mutate(start_date = year(min(Date)), end_date = year(max(Date))) %>% 
  select(Site, start_date, end_date,) %>% 
  distinct()
Date_13BND_NOAA <- CCore_13BND_NOAA %>% 
  mutate(start_date = year(min(Date)), end_date = year(max(Date))) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()

Date_08BND_CCI <- CCore_08BND_CCI %>% 
  mutate(start_date = year(min(Date)), end_date = year(max(Date))) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()
Date_08BND_NOAA <- CCore_08BND_NOAA %>% 
  mutate(start_date = year(min(Date)), end_date = year(max(Date))) %>% 
  select(Site, start_date, end_date) %>% 
  distinct()

#annual coral core
CCore_HAB05B <- CCore_H_Abrol %>% 
  select(year, HAB05B) %>% 
  na.omit()

CCore_HAB10A <- CCore_H_Abrol %>% 
  select(year, HAB10A) %>% 
  na.omit()

Date_HAB10A <- CCore_HAB10A %>% 
  mutate(start_date = min(year), end_date = max(year), Site = "HAB10A") %>%
  select(Site, start_date, end_date) %>% 
  distinct()

Date_HAB05B <- CCore_HAB05B %>% 
  mutate(start_date = min(year), end_date = max(year), Site = "HAB05B") %>%
  select(Site, start_date, end_date) %>% 
  distinct()

Date_BUN05A <- CCore_BUN05A %>% 
  mutate(start_date = min(year), end_date = max(year), Site = "BUN05A") %>%
  select(Site, start_date, end_date) %>% 
  distinct()

Date_TNT07C <- CCore_TNT07C %>% 
  mutate(start_date = min(year), end_date = max(year), Site = "TNT07C") %>%
  select(Site, start_date, end_date) %>% 
  distinct()


Date_Coral_Core <- rbind(Date_BRS05_CCI, Date_BRS05_NOAA, Date_BRS07_CCI, Date_BRS07_NOAA, Date_DAR3_CCI, Date_DAR3_NOAA, Date_DARL_CCI, Date_DARL_NOAA, Date_13TNT_CCI, Date_13TNT_NOAA, Date_08TNT_CCI, Date_08TNT_NOAA, Date_13BND_CCI, Date_13BND_NOAA, Date_08BND_CCI, Date_08BND_NOAA) %>% 
  distinct()

Date_Coral_Core_Annual <- rbind(Date_HAB05B, Date_HAB10A, Date_BUN05A, Date_TNT07C)

kbl(Date_Coral_Core, col.names = c("Site", "Start Year", "End Year")) %>% 
  kable_styling(position = "center") 

kbl(Date_Coral_Core_Annual, col.names = c("Site", "Start Year", "End Year")) %>% 
  kable_styling(position = "center") 

  

```


```{r scan_gaps_CCore, include = FALSE}
#checked - no gaps in CCI and NOAA satellite SST datasets 
#using as_tsibble(data, index = date) and scan_gaps

#read Coral Core calibrated by CCI as tsibbles and scan gaps in Coral Cores
ts_BRS05_CCI_Core <- as_tsibble(CCore_BRS05_CCI, index = yearmonth)
scan_gaps(ts_BRS05_CCI_Core) #47 gaps

ts_BRS07_CCI_Core <- as_tsibble(CCore_BRS07_CCI, index = yearmonth)
scan_gaps(ts_BRS07_CCI_Core) #47 gaps

ts_DAR3_CCI_Core <- as_tsibble(CCore_DAR3_CCI, index = yearmonth)
scan_gaps(ts_DAR3_CCI_Core) #41 gaps

ts_DARL_CCI_Core <- as_tsibble(CCore_DARL_CCI, index = yearmonth)
scan_gaps(ts_DARL_CCI_Core) #41 gaps

#found duplicate rows in 13TNT, 08TNT, 13BND, 08BND...

ts_13TNT_CCI_Core <- CCore_13TNT_CCI %>% 
  select(-Date) %>% 
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup() %>% 
  distinct() %>% 
  as_tsibble(., index = yearmonth)
scan_gaps(ts_13TNT_CCI_Core)  #26 gaps

ts_08TNT_CCI_Core <- CCore_08TNT_CCI %>% 
  select(-Date) %>% 
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup() %>% 
  distinct() %>% 
  as_tsibble(., index = yearmonth)
scan_gaps(ts_08TNT_CCI_Core) #30 gaps

ts_13BND_CCI_Core <- CCore_13BND_CCI %>% 
  select(-Date) %>% 
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup() %>% 
  distinct() %>% 
  as_tsibble(., index = yearmonth)
scan_gaps(ts_13BND_CCI_Core)  #40 gaps

ts_08BND_CCI_Core <- CCore_08BND_CCI %>% 
  select(-Date) %>% 
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup() %>% 
  distinct() %>% 
  as_tsibble(., index = yearmonth)
scan_gaps(ts_08BND_CCI_Core) #16 gaps


#read Coral Core calibrated by NOAA as tsibbles and scan gaps in Coral Cores

ts_BRS05_NOAA_Core <- as_tsibble(CCore_BRS05_NOAA, index = yearmonth)
scan_gaps(ts_BRS05_NOAA_Core) #47 gaps

ts_BRS07_NOAA_Core <- as_tsibble(CCore_BRS07_NOAA, index = yearmonth)
scan_gaps(ts_BRS07_NOAA_Core) #47 gaps

ts_DAR3_NOAA_Core <- as_tsibble(CCore_DAR3_NOAA, index = yearmonth)
scan_gaps(ts_DAR3_NOAA_Core) #41 gaps

ts_DARL_NOAA_Core <- as_tsibble(CCore_DARL_NOAA, index = yearmonth)
scan_gaps(ts_DARL_NOAA_Core) #41 gaps

#found duplicate rows in 13TNT, 08TNT, 13BND, 08BND...

ts_13TNT_NOAA_Core <- CCore_13TNT_NOAA %>% 
  select(-Date) %>% 
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup() %>% 
  distinct() %>% 
  as_tsibble(., index = yearmonth)
scan_gaps(ts_13TNT_NOAA_Core) #26 gaps

ts_08TNT_NOAA_Core <- CCore_08TNT_NOAA %>% 
  select(-Date) %>% 
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup %>%
  distinct() %>% 
  as_tsibble(., index = yearmonth)
scan_gaps(ts_08TNT_NOAA_Core) #30 gaps

ts_13BND_NOAA_Core <- CCore_13BND_NOAA %>% 
  select(-Date) %>% 
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup() %>% 
  distinct() %>% 
  as_tsibble(., index = yearmonth)
scan_gaps(ts_13BND_NOAA_Core)  #40 gaps

ts_08BND_NOAA_Core <- CCore_08BND_NOAA %>% 
  select(-Date) %>% 
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup() %>% 
  distinct() %>% 
  as_tsibble(., index = yearmonth)
scan_gaps(ts_08BND_NOAA_Core) #16 gaps

```

\newpage
# Degree Heating Month Anomaly Time Series Plots:      


```{r SST_Anomaly_TS, echo = FALSE}
#sst was averaged monthly and new column with sst_monthly generated
#duplicate rows are removed with distinct()
#date column into date format
#anomaly column is generated for ts plots

#BRS05

CCI_BRS05 <- CCI_BRS05 %>% 
  mutate(Reef_Site = "BRS05", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)
  

NOAA_BRS05 <- NOAA_BRS05 %>% 
  mutate(Data_Type = "NOAA", Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_BRS05 <- GCM_BRS05 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

CCore_BRS05_CCI <- CCore_BRS05_CCI %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (CCI)", mmm_from_sst = unique(CCI_BRS05$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

CCore_BRS05_NOAA <- CCore_BRS05_NOAA %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (NOAA)", mmm_from_sst = unique(NOAA_BRS05$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

BRS05_Combined <- rbind(CCI_BRS05, NOAA_BRS05, GCM_BRS05, CCore_BRS05_CCI, CCore_BRS05_NOAA)

ggplot(BRS05_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of BRS05 (-14.11, 123.54) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold")
  ) 


#BRS07
CCI_BRS07 <- CCI_BRS07 %>% 
  mutate(Reef_Site = "BRS07", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)


NOAA_BRS07 <- NOAA_BRS07 %>% 
  mutate(Data_Type = "NOAA", Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_BRS07 <- GCM_BRS07 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

CCore_BRS07_CCI <- CCore_BRS07_CCI %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (CCI)", mmm_from_sst = unique(CCI_BRS07$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

CCore_BRS07_NOAA <- CCore_BRS07_NOAA %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (NOAA)", mmm_from_sst = unique(NOAA_BRS07$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)


BRS07_Combined <- rbind(CCI_BRS07, NOAA_BRS07, GCM_BRS07, CCore_BRS07_CCI, CCore_BRS07_NOAA)

ggplot(BRS07_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of BRS07 (-14.12, 123.55) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  ) 


#DAR3
CCI_DAR3 <- CCI_DAR3 %>% 
  mutate(Reef_Site = "DAR3", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_DAR3 <- NOAA_DAR3 %>% 
  mutate(Data_Type = "NOAA", Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_DAR3 <- GCM_DAR3 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

CCore_DAR3_CCI <- CCore_DAR3_CCI %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (CCI)", mmm_from_sst = unique(CCI_DAR3$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

CCore_DAR3_NOAA <- CCore_DAR3_NOAA %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (NOAA)", mmm_from_sst = unique(NOAA_DAR3$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)


DAR3_Combined <- rbind(CCI_DAR3, NOAA_DAR3, GCM_DAR3, CCore_DAR3_CCI, CCore_DAR3_NOAA)

ggplot(DAR3_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of DAR3 (-12.10, 96.88) Monthly SST anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  )


#DAR Long
CCI_DARL <- CCI_DARL %>% 
  mutate(Reef_Site = "DAR Long", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_DARL <- NOAA_DARL %>% 
  mutate(Data_Type = "NOAA", Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_DARL <- GCM_DARL %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)


CCore_DARL_CCI <- CCore_DARL_CCI %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (CCI)", mmm_from_sst = unique(CCI_DARL$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

CCore_DARL_NOAA <- CCore_DARL_NOAA %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (NOAA)", mmm_from_sst = unique(NOAA_DARL$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

DARL_Combined <- rbind(CCI_DARL, NOAA_DARL, GCM_DARL, CCore_DARL_CCI, CCore_DARL_NOAA)

ggplot(DARL_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of DAR Long (-12.09, 96.88) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  )


#Scott_RPO_1
CCI_SCOTT_RPO_1 <- CCI_SCOTT_RPO_1 %>% 
  mutate(Reef_Site = "SCOTT_RPO_1", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_SCOTT_RPO_1 <- NOAA_SCOTT_RPO_1 %>% 
  mutate(Data_Type = "NOAA", Reef_Site = subsite, Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_SCOTT_RPO_1 <- GCM_SCOTT_RPO_1 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

SCOTT_RPO_1_Combined <- rbind(CCI_SCOTT_RPO_1, NOAA_SCOTT_RPO_1, GCM_SCOTT_RPO_1)

ggplot(SCOTT_RPO_1_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of SCOTT_RPO_1 (-14.06, 121.78) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  ) 


#Scott_SL4
CCI_SCOTT_SL4 <- CCI_SCOTT_SL4 %>% 
  mutate(Reef_Site = "SCOTT_SL4", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_SCOTT_SL4 <- NOAA_SCOTT_SL4 %>% 
  mutate(Data_Type = "NOAA", Reef_Site = subsite, Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_SCOTT_SL4 <- GCM_SCOTT_SL4 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

SCOTT_SL4_Combined <- rbind(CCI_SCOTT_SL4, NOAA_SCOTT_SL4, GCM_SCOTT_SL4)

ggplot(SCOTT_SL4_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of SCOTT_SL4 (-14.02, 121.86) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  ) 
  

#Scott_SS3
CCI_SCOTT_SS3 <- CCI_SCOTT_SS3 %>% 
  mutate(Reef_Site = "SCOTT_SS3", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_SCOTT_SS3 <- NOAA_SCOTT_SS3 %>% 
  mutate(Data_Type = "NOAA", Reef_Site = subsite, Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_SCOTT_SS3 <- GCM_SCOTT_SS3 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

SCOTT_SS3_Combined <- rbind(CCI_SCOTT_SS3, NOAA_SCOTT_SS3, GCM_SCOTT_SS3)

ggplot(SCOTT_SS3_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of SCOTT_SS3 (-13.64, 122.03) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  )


#ScottNR1
CCI_SCOTTNR1 <- CCI_SCOTTNR1 %>% 
  mutate(Reef_Site = "SCOTTNR1", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_SCOTTNR1 <- NOAA_SCOTTNR1 %>% 
  mutate(Data_Type = "NOAA", Reef_Site = subsite, Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_SCOTTNR1 <- GCM_SCOTTNR1 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

SCOTTNR1_Combined <- rbind(CCI_SCOTTNR1, NOAA_SCOTTNR1, GCM_SCOTTNR1)

ggplot(SCOTTNR1_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of SCOTTNR1 (-13.99, 121.88) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  ) 


#ScottSL1
CCI_SCOTTSL1 <- CCI_SCOTTSL1 %>% 
  mutate(Reef_Site = "SCOTTSL1", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_SCOTTSL1 <- NOAA_SCOTTSL1 %>% 
  mutate(Data_Type = "NOAA", Reef_Site = subsite, Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_SCOTTSL1 <- GCM_SCOTTSL1 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

SCOTTSL1_Combined <- rbind(CCI_SCOTTSL1, NOAA_SCOTTSL1, GCM_SCOTTSL1)

ggplot(SCOTTSL1_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of SCOTTSL1 (-14.08, 121.95) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  ) 


#ScottSL2
CCI_SCOTTSL2 <- CCI_SCOTTSL2 %>% 
  mutate(Reef_Site = "SCOTTSL2", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_SCOTTSL2 <- NOAA_SCOTTSL2 %>% 
  mutate(Data_Type = "NOAA", Reef_Site = subsite, Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_SCOTTSL2 <- GCM_SCOTTSL2 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

SCOTTSL2_Combined <- rbind(CCI_SCOTTSL2, NOAA_SCOTTSL2, GCM_SCOTTSL2)

ggplot(SCOTTSL2_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of SCOTTSL2 (-14.19, 121.80) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  )


#ScottSL3
CCI_SCOTTSL3 <- CCI_SCOTTSL3 %>% 
  mutate(Reef_Site = "SCOTTSL3", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_SCOTTSL3 <- NOAA_SCOTTSL3 %>% 
  mutate(Data_Type = "NOAA", Reef_Site = subsite, Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_SCOTTSL3 <- GCM_SCOTTSL3 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

SCOTTSL3_Combined <- rbind(CCI_SCOTTSL3, NOAA_SCOTTSL3, GCM_SCOTTSL3)

ggplot(SCOTTSL3_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of SCOTTSL3 (-14.07, 121.78) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  ) 


#ScottSS1
CCI_SCOTTSS1 <- CCI_SCOTTSS1 %>% 
  mutate(Reef_Site = "SCOTTSS1", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_SCOTTSS1 <- NOAA_SCOTTSS1 %>% 
  mutate(Data_Type = "NOAA", Reef_Site = subsite, Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_SCOTTSS1 <- GCM_SCOTTSS1 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

SCOTTSS1_Combined <- rbind(CCI_SCOTTSS1, NOAA_SCOTTSS1, GCM_SCOTTSS1)

ggplot(SCOTTSS1_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of SCOTTSS1 (-14.08, 121.98) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  ) 


#ScottSS2
CCI_SCOTTSS2 <- CCI_SCOTTSS2 %>% 
  mutate(Reef_Site = "SCOTTSS2", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_SCOTTSS2 <- NOAA_SCOTTSS2 %>% 
  mutate(Data_Type = "NOAA", Reef_Site = subsite, Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_SCOTTSS2 <- GCM_SCOTTSS2 %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

SCOTTSS2_Combined <- rbind(CCI_SCOTTSS2, NOAA_SCOTTSS2, GCM_SCOTTSS2)

ggplot(SCOTTSS2_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of SCOTTSS2 (-13.92, 121.92) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  ) 


#Ningaloo Bundegi
CCI_Bundegi_13BND <- CCI_Bundegi %>% 
  mutate(Reef_Site = "13BND", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_Bundegi_13BND <- NOAA_Bundegi %>% 
  mutate(Data_Type = "NOAA", Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  mutate(Reef_Site = replace(Reef_Site, Reef_Site == "Bundegi", "13BND")) %>%
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_Bundegi_13BND <- GCM_Bundegi %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  mutate(Reef_Site = replace(Reef_Site, Reef_Site == "Bundegi", "13BND")) %>%
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

CCore_13BND_CCI <- CCore_13BND_CCI %>% 
  #to handle duplicates for filling gaps later
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup %>% 
  distinct() %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (CCI)", mmm_from_sst = unique(CCI_Bundegi$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

CCore_13BND_NOAA <- CCore_13BND_NOAA %>% 
  #to handle duplicates for filling gaps later
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup %>% 
  distinct() %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (NOAA)", mmm_from_sst = unique(NOAA_Bundegi$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

Bundegi_13BND_Combined <- rbind(CCI_Bundegi_13BND, NOAA_Bundegi_13BND, GCM_Bundegi_13BND, CCore_13BND_CCI, CCore_13BND_NOAA)

ggplot(Bundegi_13BND_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of 13BND (-21.87, 114.16) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  )


CCI_Bundegi_08BND <- CCI_Bundegi %>% 
  mutate(Reef_Site = "08BND", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_Bundegi_08BND <- NOAA_Bundegi %>% 
  mutate(Data_Type = "NOAA", Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  mutate(Reef_Site = replace(Reef_Site, Reef_Site == "Bundegi", "08BND")) %>%
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_Bundegi_08BND <- GCM_Bundegi %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  mutate(Reef_Site = replace(Reef_Site, Reef_Site == "Bundegi", "08BND")) %>%
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

CCore_08BND_CCI <- CCore_08BND_CCI %>% 
  #to handle duplicates for filling gaps later
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup %>% 
  distinct() %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (CCI)", mmm_from_sst = unique(CCI_Bundegi$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

CCore_08BND_NOAA <- CCore_08BND_NOAA %>% 
  #to handle duplicates for filling gaps later
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup %>% 
  distinct() %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (NOAA)", mmm_from_sst = unique(NOAA_Bundegi$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

Bundegi_08BND_Combined <- rbind(CCI_Bundegi_08BND, NOAA_Bundegi_08BND, GCM_Bundegi_08BND, CCore_08BND_CCI, CCore_08BND_NOAA)

ggplot(Bundegi_08BND_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of 08BND (-21.87, 114.16) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  )

#Ningaloo Tantabiddi 13TNT
CCI_Tantabiddi_13TNT <- CCI_Tantabiddi %>% 
  mutate(Reef_Site = "13TNT", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_Tantabiddi_13TNT <- NOAA_Tantabiddi %>% 
  mutate(Data_Type = "NOAA", Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  mutate(Reef_Site = "13TNT") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_Tantabiddi_13TNT <- GCM_Tantabiddi %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  mutate(Reef_Site = replace(Reef_Site, Reef_Site == "Tantabiddi", "13TNT")) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

CCore_13TNT_CCI <- CCore_13TNT_CCI %>% 
  #to handle duplicates for filling gaps later
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup %>% 
  distinct() %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (CCI)", mmm_from_sst = unique(CCI_Tantabiddi_13TNT$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

CCore_13TNT_NOAA <- CCore_13TNT_NOAA %>% 
  #to handle duplicates for filling gaps later
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup %>% 
  distinct() %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (NOAA)", mmm_from_sst = unique(NOAA_Tantabiddi_13TNT$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

Tantabiddi_13TNT_Combined <- rbind(CCI_Tantabiddi_13TNT, NOAA_Tantabiddi_13TNT, GCM_Tantabiddi_13TNT, CCore_13TNT_CCI, CCore_13TNT_NOAA)

ggplot(Tantabiddi_13TNT_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of 13TNT (-21.91, 113.97) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  ) 

#Ningaloo Tantabiddi 08TNT
CCI_Tantabiddi_08TNT <- CCI_Tantabiddi %>% 
  mutate(Reef_Site = "08TNT", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_Tantabiddi_08TNT <- NOAA_Tantabiddi %>% 
  mutate(Data_Type = "NOAA", Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  mutate(Reef_Site = "08TNT") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_Tantabiddi_08TNT <- GCM_Tantabiddi %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  mutate(Reef_Site = replace(Reef_Site, Reef_Site == "Tantabiddi", "08TNT")) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

CCore_08TNT_CCI <- CCore_08TNT_CCI %>% 
  #to handle duplicates for filling gaps later
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup %>% 
  distinct() %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (CCI)", mmm_from_sst = unique(CCI_Tantabiddi_08TNT$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)

CCore_08TNT_NOAA <- CCore_08TNT_NOAA %>% 
  #to handle duplicates for filling gaps later
  group_by(yearmonth) %>% 
  mutate(sst = mean(sst), SrCa = mean(SrCa)) %>% 
  ungroup %>% 
  distinct() %>% 
  rename(sst_monthly = sst, date = yearmonth, Reef_Site = Site) %>% 
  mutate(Data_Type = "Coral Core (NOAA)", mmm_from_sst = unique(NOAA_Tantabiddi_08TNT$mmm_from_sst), anomaly = sst_monthly - mmm_from_sst, monthly_date = date) %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst, date, anomaly)


Tantabiddi_08TNT_Combined <- rbind(CCI_Tantabiddi_08TNT, NOAA_Tantabiddi_08TNT, GCM_Tantabiddi_08TNT, CCore_08TNT_CCI, CCore_08TNT_NOAA)

ggplot(Tantabiddi_08TNT_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of 08TNT (-21.91, 113.97) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  ) 


#Houtman Abrolhos HAB05B
CCI_HAB05B <- CCI_HAB05B %>% 
  mutate(Reef_Site = "HAB05B", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_HAB05B <- NOAA_HAB05B %>% 
  mutate(Data_Type = "NOAA", Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_HAB05B <- GCM_HAB05B %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

HAB05B_Combined <- rbind(CCI_HAB05B, NOAA_HAB05B, GCM_HAB05B)

ggplot(HAB05B_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of HAB05B (-28.46, 113.77) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  ) 


#Houtman Abrolhos HAB10A
CCI_HAB10A <- CCI_HAB10A %>% 
  mutate(Reef_Site = "HAB10A", Data_Type = "CCI") %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

NOAA_HAB10A <- NOAA_HAB10A %>% 
  mutate(Data_Type = "NOAA", Year = year(Date), Month = month((Date), label = TRUE)) %>% 
  mutate(monthly_date = str_c(Year, Month, sep = "-")) %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

GCM_HAB10A <- GCM_HAB10A %>% 
  group_by(monthly_date) %>% 
  mutate(sst_monthly = mean(sst)) %>% 
  ungroup() %>% 
  select(sst_monthly, Latitude, Longitude, monthly_date, Reef_Site, Data_Type, mmm_from_sst) %>% 
  distinct() %>% 
  mutate(date = monthly_date, monthly_date = ym(monthly_date), anomaly = sst_monthly - mmm_from_sst)

HAB10A_Combined <- rbind(CCI_HAB10A, NOAA_HAB10A, GCM_HAB10A)

ggplot(HAB10A_Combined)+
  geom_path(aes(x = monthly_date, y = anomaly, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Time", y = "Monthly SST Anomaly", title = "Time Series of HAB10A (-28.46, 113.75) Monthly SST Anomalies") +
  scale_color_discrete_diverging(name = "Data Source") +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text( face = "bold")
  )


```
\newpage
```{r fill_gaps, include = FALSE}
# before calculating Degree Heating Months, it is important to fill gaps in time
# prevent inaccurate running sum of DHM values when there is missing gap in time

#filling gaps for coral core data calibrated with CCI
CCore_BRS05_CCI <- CCore_BRS05_CCI %>% 
  as_tsibble(index = date) %>% 
  fill_gaps(anomaly = 0, Reef_Site = "BRS05", Data_Type = "Coral Core (CCI)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_BRS07_CCI <- CCore_BRS07_CCI %>% 
  as_tsibble(index = date) %>% 
  fill_gaps(anomaly = 0, Reef_Site = "BRS07", Data_Type = "Coral Core (CCI)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_DAR3_CCI <- CCore_DAR3_CCI %>% 
  as_tsibble(index = date) %>% 
  fill_gaps(anomaly = 0, Reef_Site = "DAR3", Data_Type = "Coral Core (CCI)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_DARL_CCI <- CCore_DARL_CCI %>% 
  as_tsibble(index = date) %>%  
  fill_gaps(anomaly = 0, Reef_Site = "DARL", Data_Type = "Coral Core (CCI)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_13TNT_CCI <- CCore_13TNT_CCI %>% 
  as_tsibble(index = date) %>%  
  fill_gaps(anomaly = 0, Reef_Site = "13TNT", Data_Type = "Coral Core (CCI)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_08TNT_CCI <- CCore_08TNT_CCI %>% 
  as_tsibble(index = date) %>%  
  fill_gaps(anomaly = 0, Reef_Site = "08TNT", Data_Type = "Coral Core (CCI)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_13BND_CCI <- CCore_13BND_CCI %>% 
  as_tsibble(index = date) %>%  
  fill_gaps(anomaly = 0, Reef_Site = "13BND", Data_Type = "Coral Core (CCI)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_08BND_CCI <- CCore_08BND_CCI %>% 
  as_tsibble(index = date) %>%  
  fill_gaps(anomaly = 0, Reef_Site = "08BND", Data_Type = "Coral Core (CCI)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

#filling gaps for coral core data calibrated with NOAA

CCore_BRS05_NOAA <- CCore_BRS05_NOAA %>% 
  as_tsibble(index = date) %>%  
  fill_gaps(anomaly = 0, Reef_Site = "BRS05", Data_Type = "Coral Core (NOAA)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_BRS07_NOAA <- CCore_BRS07_NOAA %>% 
  as_tsibble(index = date) %>%  
  fill_gaps(anomaly = 0, Reef_Site = "BRS07", Data_Type = "Coral Core (NOAA)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_DAR3_NOAA <- CCore_DAR3_NOAA %>% 
  as_tsibble(index = date) %>%  
  fill_gaps(anomaly = 0, Reef_Site = "DAR3", Data_Type = "Coral Core (NOAA)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_DARL_NOAA <- CCore_DARL_NOAA %>% 
  as_tsibble(index = date) %>%  
  fill_gaps(anomaly = 0, Reef_Site = "DARL", Data_Type = "Coral Core (NOAA)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_13TNT_NOAA <- CCore_13TNT_NOAA %>% 
  as_tsibble(index = date) %>%   
  fill_gaps(anomaly = 0, Reef_Site = "13TNT", Data_Type = "Coral Core (NOAA)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_08TNT_NOAA <- CCore_08TNT_NOAA %>% 
  as_tsibble(index = date) %>%  
  fill_gaps(anomaly = 0, Reef_Site = "08TNT", Data_Type = "Coral Core (NOAA)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date)) 

CCore_13BND_NOAA <- CCore_13BND_NOAA %>% 
  as_tsibble(index = date) %>%   
  fill_gaps(anomaly = 0, Reef_Site = "13BND", Data_Type = "Coral Core (NOAA)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

CCore_08BND_NOAA <- CCore_08BND_NOAA %>% 
  as_tsibble(index = date) %>%  
  fill_gaps(anomaly = 0, Reef_Site = "08BND", Data_Type = "Coral Core (NOAA)") %>% 
  as_tibble() %>% 
  mutate(monthly_date = as.Date(date))

```


```{r setting_colors_data_type, include = FALSE}

# for sites with coral core data
cols <- c("GCM" = "forest green", "CCI" = "red", "NOAA" = "navy blue", "Coral Core (CCI)" = "dark red", "Coral Core (NOAA)" = "orange")

#for sites without coral core data
cols_no_cc <- c("GCM" = "forest green", "CCI" = "red", "NOAA" = "navy blue")
```


\newpage

# **BRS05** Degree Heating Months Time Series


```{r DHM_BRS05, echo = FALSE, message = FALSE, warning = FALSE}

#DHM calculations for CCI dataset 
BRS05_DHM <- rep(0,nrow(CCI_BRS05))
BRS05_negative_anomaly <- 0
for (i in 1:nrow(CCI_BRS05)){
  if(CCI_BRS05$anomaly[i] > 0) {
    BRS05_negative_anomaly <- 
      BRS05_negative_anomaly + CCI_BRS05$anomaly[i]
  } else {
    BRS05_negative_anomaly <- 0
  }
  BRS05_DHM[i] <- BRS05_negative_anomaly
}

CCI_BRS05 <- CCI_BRS05 %>% 
  add_column(BRS05_DHM)

write_csv(CCI_BRS05, here::here("data_raw/DHM/CCI_BRS05_DHM.csv"))

#DHM calculations for NOAA dataset
BRS05_DHM <- rep(0,nrow(NOAA_BRS05))
BRS05_negative_anomaly <- 0
for (i in 1:nrow(NOAA_BRS05)){
  if(NOAA_BRS05$anomaly[i] > 0) {
    BRS05_negative_anomaly <- 
      BRS05_negative_anomaly + NOAA_BRS05$anomaly[i]
  } else {
    BRS05_negative_anomaly <- 0
  }
  BRS05_DHM[i] <- BRS05_negative_anomaly
}

NOAA_BRS05 <- NOAA_BRS05 %>% 
  add_column(BRS05_DHM)

write_csv(NOAA_BRS05, here::here("data_raw/DHM/NOAA_BRS05_DHM.csv"))

#DHM calculations for GCM dataset
BRS05_DHM <- rep(0,nrow(GCM_BRS05))
BRS05_negative_anomaly <- 0
for (i in 1:nrow(GCM_BRS05)){
  if(GCM_BRS05$anomaly[i] > 0) {
    BRS05_negative_anomaly <- 
      BRS05_negative_anomaly + GCM_BRS05$anomaly[i]
  } else {
    BRS05_negative_anomaly <- 0
  }
  BRS05_DHM[i] <- BRS05_negative_anomaly
}

GCM_BRS05 <- GCM_BRS05 %>% 
  add_column(BRS05_DHM)

write_csv(GCM_BRS05, here::here("data_raw/DHM/GCM_BRS05_DHM.csv"))

#DHM calculations for Coral Core (CCI) dataset
BRS05_DHM <- rep(0,nrow(CCore_BRS05_CCI))
BRS05_negative_anomaly <- 0
for (i in 1:nrow(CCore_BRS05_CCI)){
  if(CCore_BRS05_CCI$anomaly[i] > 0) {
    BRS05_negative_anomaly <- 
      BRS05_negative_anomaly + CCore_BRS05_CCI$anomaly[i]
  } else {
    BRS05_negative_anomaly <- 0
  }
  BRS05_DHM[i] <- BRS05_negative_anomaly
}

CCore_BRS05_CCI <- CCore_BRS05_CCI %>% 
  add_column(BRS05_DHM) %>% 
  mutate(BRS05_DHM = if_else(is.na(sst_monthly), NA_real_ , BRS05_DHM))

write_csv(CCore_BRS05_CCI, here::here("data_raw/DHM/CCore_BRS05_CCI_DHM.csv"))

#DHM calculations for Coral Core (NOAA) dataset
BRS05_DHM <- rep(0,nrow(CCore_BRS05_NOAA))
BRS05_negative_anomaly <- 0
for (i in 1:nrow(CCore_BRS05_NOAA)){
  if(CCore_BRS05_NOAA$anomaly[i] > 0) {
    BRS05_negative_anomaly <- 
      BRS05_negative_anomaly + CCore_BRS05_NOAA$anomaly[i]
  } else {
    BRS05_negative_anomaly <- 0
  }
  BRS05_DHM[i] <- BRS05_negative_anomaly
}

CCore_BRS05_NOAA <- CCore_BRS05_NOAA %>%
  add_column(BRS05_DHM) %>% 
  mutate(BRS05_DHM = if_else(is.na(sst_monthly), NA_real_ , BRS05_DHM))

write_csv(CCore_BRS05_NOAA, here::here("data_raw/DHM/CCore_BRS05_NOAA_DHM.csv"))

#Combining datasets with DHM calculations
BRS05_Combined <- rbind(CCI_BRS05, NOAA_BRS05, GCM_BRS05, CCore_BRS05_CCI, CCore_BRS05_NOAA)

#Cumulative Plot
BRS05_cum_HSdays <- BRS05_Combined %>% 
  select(monthly_date, Reef_Site, Data_Type, BRS05_DHM) %>% 
  mutate(BRS05_DHM = if_else(BRS05_DHM > 1, 1, 0)) %>% 
  group_by(Data_Type) %>% 
  mutate(DHM_months_count = cumsum(BRS05_DHM)) %>% 
  ungroup() %>% 
  select(-BRS05_DHM)

ggplot(BRS05_cum_HSdays) +
  geom_line(aes(x = monthly_date, y = DHM_months_count, color = Data_Type)) + 
  labs(x = "Time", y = "Cumulative high DHM months", title = "BRS05", color = "Data Type") +
  scale_x_date(limits = as_date(c("1985-01-01","2021-01-01"))) 

#DHM >= 1
High_BRS05_DHM <- BRS05_Combined %>% 
  filter(BRS05_DHM >= 1) %>% 
  select(monthly_date, Reef_Site, Data_Type, BRS05_DHM) %>% 
  mutate(monthly_date = yearmonth(monthly_date)) %>% 
  pivot_wider(names_from = Data_Type, values_from = BRS05_DHM) %>% 
  arrange(-desc(monthly_date)) %>% 
  rename(Date = monthly_date, Site = Reef_Site)

color.me <- which(High_BRS05_DHM$`Coral Core (CCI)`> 0 | High_BRS05_DHM$`Coral Core (NOAA)` >0)


#kbl(High_BRS05_DHM, longtable = T, caption = "Coral Core Date Range is from 1985 to 2011") %>% 
#  kable_styling(position = "center", latex_options = c("repeat_header")) %>% 
#  add_header_above(c(" " = 2, "Degree Heating Month Values in BRS05" = 4), bold = TRUE) %>% 
#  row_spec(color.me, color = "red")


#Visualising DHM values in CCI, NOAA, GCM and CCore 
BRS05 <- BRS05_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = BRS05_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  labs(x = "Date", y = "Degree Heating Month", title = "BRS05 (-14.11, 123.54)")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  )

#visualising in separate plots
BRS05_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = BRS05_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "BRS05 Degree Heating Month values time plot")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  ) +
  facet_wrap(~BRS05_Combined$Data_Type)

ggsave("Supp_BRS05_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)
```

\newpage
# **BRS07** Degree Heating Months Time Series


```{r DHM_BRS07, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
BRS07_DHM <- rep(0,nrow(CCI_BRS07))
BRS07_negative_anomaly <- 0
for (i in 1:nrow(CCI_BRS07)){
  if(CCI_BRS07$anomaly[i] > 0) {
    BRS07_negative_anomaly <- 
      BRS07_negative_anomaly + CCI_BRS07$anomaly[i]
  } else {
    BRS07_negative_anomaly <- 0
  }
  BRS07_DHM[i] <- BRS07_negative_anomaly
}

CCI_BRS07 <- CCI_BRS07 %>% 
  add_column(BRS07_DHM) 

write_csv(CCI_BRS07, here::here("data_raw/DHM/CCI_BRS07_DHM.csv"))

#DHM calculations for NOAA dataset
BRS07_DHM <- rep(0,nrow(NOAA_BRS07))
BRS07_negative_anomaly <- 0
for (i in 1:nrow(NOAA_BRS07)){
  if(NOAA_BRS07$anomaly[i] > 0) {
    BRS07_negative_anomaly <- 
      BRS07_negative_anomaly + NOAA_BRS07$anomaly[i]
  } else {
    BRS07_negative_anomaly <- 0
  }
  BRS07_DHM[i] <- BRS07_negative_anomaly
}

NOAA_BRS07 <- NOAA_BRS07 %>% 
  add_column(BRS07_DHM)

write_csv(NOAA_BRS07, here::here("data_raw/DHM/NOAA_BRS07_DHM.csv"))

#DHM calculations for GCM dataset 
BRS07_DHM <- rep(0,nrow(GCM_BRS07))
BRS07_negative_anomaly <- 0
for (i in 1:nrow(GCM_BRS07)){
  if(GCM_BRS07$anomaly[i] > 0) {
    BRS07_negative_anomaly <- 
      BRS07_negative_anomaly + GCM_BRS07$anomaly[i]
  } else {
    BRS07_negative_anomaly <- 0
  }
  BRS07_DHM[i] <- BRS07_negative_anomaly
}

GCM_BRS07 <- GCM_BRS07 %>% 
  add_column(BRS07_DHM) 

write_csv(GCM_BRS07, here::here("data_raw/DHM/GCM_BRS07_DHM.csv"))

#DHM calculations for Coral Core (CCI) dataset
BRS07_DHM <- rep(0,nrow(CCore_BRS07_CCI))
BRS07_negative_anomaly <- 0
for (i in 1:nrow(CCore_BRS07_CCI)){
  if(CCore_BRS07_CCI$anomaly[i] > 0) {
    BRS07_negative_anomaly <- 
      BRS07_negative_anomaly + CCore_BRS07_CCI$anomaly[i]
  } else {
    BRS07_negative_anomaly <- 0
  }
  BRS07_DHM[i] <- BRS07_negative_anomaly
}

CCore_BRS07_CCI <- CCore_BRS07_CCI %>% 
  add_column(BRS07_DHM) %>% 
  mutate(BRS07_DHM = if_else(is.na(sst_monthly), NA_real_ , BRS07_DHM))

write_csv(CCore_BRS07_CCI, here::here("data_raw/DHM/CCore_BRS07_CCI_DHM.csv"))

#DHM calculations for Coral Core (NOAA) dataset
BRS07_DHM <- rep(0,nrow(CCore_BRS07_NOAA))
BRS07_negative_anomaly <- 0
for (i in 1:nrow(CCore_BRS07_NOAA)){
  if(CCore_BRS07_NOAA$anomaly[i] > 0) {
    BRS07_negative_anomaly <- 
      BRS07_negative_anomaly + CCore_BRS07_NOAA$anomaly[i]
  } else {
    BRS07_negative_anomaly <- 0
  }
  BRS07_DHM[i] <- BRS07_negative_anomaly
}

CCore_BRS07_NOAA <- CCore_BRS07_NOAA %>% 
  add_column(BRS07_DHM) %>% 
  mutate(BRS07_DHM = if_else(is.na(sst_monthly), NA_real_ , BRS07_DHM))

write_csv(CCore_BRS07_NOAA, here::here("data_raw/DHM/CCore_BRS07_NOAA_DHM.csv"))

#Combining datasets with DHM calculations
BRS07_Combined <- rbind(CCI_BRS07, NOAA_BRS07, GCM_BRS07, CCore_BRS07_CCI, CCore_BRS07_NOAA)
BRS07_Combined_noCC <- rbind(CCI_BRS07, NOAA_BRS07, GCM_BRS07)

#Cumulative Plot
BRS07_cum_HSdays <- BRS07_Combined_noCC %>% 
  select(monthly_date, Reef_Site, Data_Type, BRS07_DHM) %>% 
  mutate(BRS07_DHM = if_else(BRS07_DHM > 1, 1, 0)) %>% 
  group_by(Data_Type) %>% 
  mutate(DHM_months_count = cumsum(BRS07_DHM)) %>% 
  ungroup() %>% 
  select(-BRS07_DHM) %>% 
  filter(monthly_date < "2021-01-01")

BRS07_cum <- ggplot(BRS07_cum_HSdays) +
  geom_smooth(aes(x = monthly_date, y = DHM_months_count, color = Data_Type)) + 
  labs(x = "Time", y = "Cumulative high DHM months", title = "BRS07", color = "Data Type") 

BRS07_cum


#DHM >= 1
High_BRS07_DHM <- BRS07_Combined %>% 
  filter(BRS07_DHM >= 1) %>% 
  select(monthly_date, Reef_Site, Data_Type, BRS07_DHM) %>% 
  mutate(monthly_date = yearmonth(monthly_date)) %>% 
  pivot_wider(names_from = Data_Type, values_from = BRS07_DHM) %>% 
  arrange(-desc(monthly_date)) %>% 
  rename(Date = monthly_date, Site = Reef_Site)

color.me <- which(High_BRS07_DHM$`Coral Core (CCI)`> 0 | High_BRS07_DHM$`Coral Core (NOAA)` >0)

#kbl(High_BRS07_DHM, longtable = T, caption = "Coral Core Date Range is from 1985 to 2011") %>% 
#  kable_styling(position = "center", latex_options = c("repeat_header")) %>% 
#  add_header_above(c(" " = 2, "Degree Heating Month Values in BRS07" = 4), bold = TRUE) %>% 
#  row_spec(color.me, color = "red")

#Visualising DHM values in CCI, NOAA, GCM and CCore 
BRS07 <- BRS07_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2016-01-01")), xmax = as.Date(c("2017-01-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = BRS07_DHM, color = Data_Type), alpha = 0.5, size = 1) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  annotate(geom = "text", x = as.Date("2027-01-01"), y = Inf, label = "(S)NOAA>CCI>GCM", size = 3, vjust = 1)+
  labs(x = "", y = "Degree Heating Month", title = "(b) BRS07 (-14.12, 123.55)", subtitle = "Browse Island")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "none",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  )

#visualising in separate plots
BRS07_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = BRS07_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "BRS07 Degree Heating Month values time plot")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  ) +
  facet_wrap(~BRS07_Combined$Data_Type)

ggsave("Supp_BRS07_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)

```

\newpage
# **DAR3** Degree Heating Months Time Series

```{r DHM_DAR3, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
DAR3_DHM <- rep(0,nrow(CCI_DAR3))
DAR3_negative_anomaly <- 0
for (i in 1:nrow(CCI_DAR3)){
  if(CCI_DAR3$anomaly[i] > 0) {
    DAR3_negative_anomaly <- 
      DAR3_negative_anomaly + CCI_DAR3$anomaly[i]
  } else {
    DAR3_negative_anomaly <- 0
  }
  DAR3_DHM[i] <- DAR3_negative_anomaly
}

CCI_DAR3 <- CCI_DAR3 %>% 
  add_column(DAR3_DHM)

write_csv(CCI_DAR3, here::here("data_raw/DHM/CCI_DAR3_DHM.csv"))

#DHM calculations for NOAA dataset
DAR3_DHM <- rep(0,nrow(NOAA_DAR3))
DAR3_negative_anomaly <- 0
for (i in 1:nrow(NOAA_DAR3)){
  if(NOAA_DAR3$anomaly[i] > 0) {
    DAR3_negative_anomaly <- 
      DAR3_negative_anomaly + NOAA_DAR3$anomaly[i]
  } else {
    DAR3_negative_anomaly <- 0
  }
  DAR3_DHM[i] <- DAR3_negative_anomaly
}

NOAA_DAR3 <- NOAA_DAR3 %>% 
  add_column(DAR3_DHM)

write_csv(NOAA_DAR3, here::here("data_raw/DHM/NOAA_DAR3_DHM.csv"))

#DHM calculations for GCM dataset 
DAR3_DHM <- rep(0,nrow(GCM_DAR3))
DAR3_negative_anomaly <- 0
for (i in 1:nrow(GCM_DAR3)){
  if(GCM_DAR3$anomaly[i] > 0) {
    DAR3_negative_anomaly <- 
      DAR3_negative_anomaly + GCM_DAR3$anomaly[i]
  } else {
    DAR3_negative_anomaly <- 0
  }
  DAR3_DHM[i] <- DAR3_negative_anomaly
}

GCM_DAR3 <- GCM_DAR3 %>% 
  add_column(DAR3_DHM)

write_csv(GCM_DAR3, here::here("data_raw/DHM/GCM_DAR3_DHM.csv"))

#DHM calculations for Coral Core (CCI) dataset
DAR3_DHM <- rep(0,nrow(CCore_DAR3_CCI))
DAR3_negative_anomaly <- 0
for (i in 1:nrow(CCore_DAR3_CCI)){
  if(CCore_DAR3_CCI$anomaly[i] > 0) {
    DAR3_negative_anomaly <- 
      DAR3_negative_anomaly + CCore_DAR3_CCI$anomaly[i]
  } else {
    DAR3_negative_anomaly <- 0
  }
  DAR3_DHM[i] <- DAR3_negative_anomaly
}

CCore_DAR3_CCI <- CCore_DAR3_CCI %>% 
  add_column(DAR3_DHM) %>% 
  mutate(DAR3_DHM = if_else(is.na(sst_monthly), NA_real_ , DAR3_DHM))

write_csv(CCore_DAR3_CCI, here::here("data_raw/DHM/CCore_DAR3_CCI_DHM.csv"))

#DHM calculations for Coral Core (NOAA) dataset
DAR3_DHM <- rep(0,nrow(CCore_DAR3_NOAA))
DAR3_negative_anomaly <- 0
for (i in 1:nrow(CCore_DAR3_NOAA)){
  if(CCore_DAR3_NOAA$anomaly[i] > 0) {
    DAR3_negative_anomaly <- 
      DAR3_negative_anomaly + CCore_DAR3_NOAA$anomaly[i]
  } else {
    DAR3_negative_anomaly <- 0
  }
  DAR3_DHM[i] <- DAR3_negative_anomaly
}

CCore_DAR3_NOAA <- CCore_DAR3_NOAA %>% 
  add_column(DAR3_DHM) %>% 
  mutate(DAR3_DHM = if_else(is.na(sst_monthly), NA_real_ , DAR3_DHM))

write_csv(CCore_DAR3_NOAA, here::here("data_raw/DHM/CCore_DAR3_NOAA_DHM.csv"))

#Combining datasets with DHM calculations
DAR3_Combined <- rbind(CCI_DAR3, NOAA_DAR3, GCM_DAR3, CCore_DAR3_CCI, CCore_DAR3_NOAA)

#DHM in descending order
#Max_DHM_CCI_DAR3 <- CCI_DAR3 %>% 
#  arrange(desc(DAR3_DHM)) %>% 
#  select(date, DAR3_DHM)
#Max_DHM_NOAA_DAR3 <- NOAA_DAR3 %>% 
#  arrange(desc(DAR3_DHM)) %>% 
#  select(date, DAR3_DHM)


#knitr::kable(list(Max_DHM_CCI_DAR3, Max_DHM_NOAA_DAR3), caption = "Degree Heating Month values in DAR3 from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
DAR3 <- DAR3_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1995-06-01")), xmax = as.Date(c("1997-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2013-06-01")), xmax = as.Date(c("2015-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("1995-06-01"), y = Inf, label = "1996", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("1999-06-01"), y = Inf, label = "1998", hjust = 0, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2013-06-01"), y = Inf, label = "2014", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  geom_line(aes(x = monthly_date, y = DAR3_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "DAR3 (-12.10, 96.88)")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  )

#visualising in separate plots
DAR3_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1995-06-01")), xmax = as.Date(c("1997-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2013-06-01")), xmax = as.Date(c("2015-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = DAR3_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "DAR3 Degree Heating Month values time plot")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  ) +
  facet_wrap(~DAR3_Combined$Data_Type)

ggsave("Supp_DAR3_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)

```

\newpage
# **DAR Long** Degree Heating Months Time Series

```{r DHM_DARL, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
DARL_DHM <- rep(0,nrow(CCI_DARL))
DARL_negative_anomaly <- 0
for (i in 1:nrow(CCI_DARL)){
  if(CCI_DARL$anomaly[i] > 0) {
    DARL_negative_anomaly <- 
      DARL_negative_anomaly + CCI_DARL$anomaly[i]
  } else {
    DARL_negative_anomaly <- 0
  }
  DARL_DHM[i] <- DARL_negative_anomaly
}

CCI_DARL <- CCI_DARL %>% 
  add_column(DARL_DHM)

write_csv(CCI_DARL, here::here("data_raw/DHM/CCI_DARL_DHM.csv"))

#DHM calculations for NOAA dataset
DARL_DHM <- rep(0,nrow(NOAA_DARL))
DARL_negative_anomaly <- 0
for (i in 1:nrow(NOAA_DARL)){
  if(NOAA_DARL$anomaly[i] > 0) {
    DARL_negative_anomaly <- 
      DARL_negative_anomaly + NOAA_DARL$anomaly[i]
  } else {
    DARL_negative_anomaly <- 0
  }
  DARL_DHM[i] <- DARL_negative_anomaly
}

NOAA_DARL <- NOAA_DARL %>% 
  add_column(DARL_DHM)

write_csv(NOAA_DARL, here::here("data_raw/DHM/NOAA_DARL_DHM.csv"))

#DHM calculations for GCM dataset 
DARL_DHM <- rep(0,nrow(GCM_DARL))
DARL_negative_anomaly <- 0
for (i in 1:nrow(GCM_DARL)){
  if(GCM_DARL$anomaly[i] > 0) {
    DARL_negative_anomaly <- 
      DARL_negative_anomaly + GCM_DARL$anomaly[i]
  } else {
    DARL_negative_anomaly <- 0
  }
  DARL_DHM[i] <- DARL_negative_anomaly
}

GCM_DARL <- GCM_DARL %>% 
  add_column(DARL_DHM)

write_csv(GCM_DARL, here::here("data_raw/DHM/GCM_DARL_DHM.csv"))

#DHM calculations for Coral Core (CCI) dataset
DARL_DHM <- rep(0,nrow(CCore_DARL_CCI))
DARL_negative_anomaly <- 0
for (i in 1:nrow(CCore_DARL_CCI)){
  if(CCore_DARL_CCI$anomaly[i] > 0) {
    DARL_negative_anomaly <- 
      DARL_negative_anomaly + CCore_DARL_CCI$anomaly[i]
  } else {
    DARL_negative_anomaly <- 0
  }
  DARL_DHM[i] <- DARL_negative_anomaly
}

CCore_DARL_CCI <- CCore_DARL_CCI %>% 
  add_column(DARL_DHM) %>% 
  mutate(DARL_DHM = if_else(is.na(sst_monthly), NA_real_ , DARL_DHM))

write_csv(CCore_DARL_CCI, here::here("data_raw/DHM/CCore_DARL_CCI_DHM.csv"))

#DHM calculations for Coral Core (NOAA) dataset
DARL_DHM <- rep(0,nrow(CCore_DARL_NOAA))
DARL_negative_anomaly <- 0
for (i in 1:nrow(CCore_DARL_NOAA)){
  if(CCore_DARL_NOAA$anomaly[i] > 0) {
    DARL_negative_anomaly <- 
      DARL_negative_anomaly + CCore_DARL_NOAA$anomaly[i]
  } else {
    DARL_negative_anomaly <- 0
  }
  DARL_DHM[i] <- DARL_negative_anomaly
}

CCore_DARL_NOAA <- CCore_DARL_NOAA %>% 
  add_column(DARL_DHM) %>% 
  mutate(DARL_DHM = if_else(is.na(sst_monthly), NA_real_ , DARL_DHM))

write_csv(CCore_DARL_NOAA, here::here("data_raw/DHM/CCore_DARL_NOAA_DHM.csv"))

#Combining datasets with DHM calculations
DARL_Combined <- rbind(CCI_DARL, NOAA_DARL, GCM_DARL, CCore_DARL_CCI, CCore_DARL_NOAA)
DARL_Combined_noCC <- rbind(CCI_DARL, NOAA_DARL, GCM_DARL)

#Cumulative Plot
DARL_cum_HSdays <- DARL_Combined_noCC %>% 
  select(monthly_date, Reef_Site, Data_Type, DARL_DHM) %>% 
  mutate(DARL_DHM = if_else(DARL_DHM > 1, 1, 0)) %>% 
  group_by(Data_Type) %>% 
  mutate(DHM_months_count = cumsum(DARL_DHM)) %>% 
  ungroup() %>% 
  select(-DARL_DHM) %>% 
  filter(monthly_date < "2021-01-01")

DARL_cum <- ggplot(DARL_cum_HSdays) +
  geom_smooth(aes(x = monthly_date, y = DHM_months_count, color = Data_Type)) + 
  labs(x = "Time", y = "Cumulative high DHM months", title = "DARL", color = "Data Type") 

DARL_cum

#DHM >= 1
High_DARL_DHM <- DARL_Combined %>% 
  filter(DARL_DHM >= 1) %>% 
  select(monthly_date, Reef_Site, Data_Type, DARL_DHM) %>% 
  mutate(monthly_date = yearmonth(monthly_date)) %>% 
  pivot_wider(names_from = Data_Type, values_from = DARL_DHM) %>% 
  arrange(-desc(monthly_date)) %>% 
  rename(Date = monthly_date, Site = Reef_Site)

color.me <- which(High_DARL_DHM$`Coral Core (CCI)`> 0 | High_DARL_DHM$`Coral Core (NOAA)` >0)

#kbl(High_DARL_DHM, longtable = T, caption = "Coral Core Date Range is from 1985 to 2009") %>%
#  kable_styling(position = "center", latex_options = c("repeat_header")) %>% 
#  add_header_above(c(" " = 2, "Degree Heating Month Values in DAR Long" = 4), bold = TRUE) %>% 
#  row_spec(color.me, color = "red")

#Visualising DHM values in CCI, NOAA, GCM and CCore 
DARL <- DARL_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1996-01-01")), xmax = as.Date(c("1997-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("1998-01-01")), xmax = as.Date(c("1999-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2014-01-01")), xmax = as.Date(c("2015-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2016-01-01")), xmax = as.Date(c("2017-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("1995-06-01"), y = Inf, label = "1996", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("1999-06-01"), y = Inf, label = "1998", hjust = 0, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2013-06-01"), y = Inf, label = "2014", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  annotate(geom = "text", x = as.Date("2027-01-01"), y = Inf, label = "(M)GCM>CCI>NOAA", size = 3, vjust = 1)+
  geom_line(aes(x = monthly_date, y = DARL_DHM, color = Data_Type), alpha = 0.5, size = 1) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "", y = "Degree Heating Month", title = "(a) DAR Long (-12.09, 96.88)", subtitle = "Cocos Keeling Island")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "none",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  )

#visualising in separate plots
DARL_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1995-06-01")), xmax = as.Date(c("1997-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2013-06-01")), xmax = as.Date(c("2015-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = DARL_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "DARL Degree Heating Month values time plot")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  ) +
  facet_wrap(~DARL_Combined$Data_Type)

ggsave("Supp_DARL_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)


```


\newpage
# **SCOTT_RPO_1** Degree Heating Months Time Series

```{r DHM_SCOTT_RPO_1, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
SCOTT_RPO_1_DHM <- rep(0,nrow(CCI_SCOTT_RPO_1))
SCOTT_RPO_1_negative_anomaly <- 0
for (i in 1:nrow(CCI_SCOTT_RPO_1)){
  if(CCI_SCOTT_RPO_1$anomaly[i] > 0) {
    SCOTT_RPO_1_negative_anomaly <- 
      SCOTT_RPO_1_negative_anomaly + CCI_SCOTT_RPO_1$anomaly[i]
  } else {
    SCOTT_RPO_1_negative_anomaly <- 0
  }
  SCOTT_RPO_1_DHM[i] <- SCOTT_RPO_1_negative_anomaly
}

CCI_SCOTT_RPO_1 <- CCI_SCOTT_RPO_1 %>% 
  add_column(SCOTT_RPO_1_DHM)

write_csv(CCI_SCOTT_RPO_1, here::here("data_raw/DHM/CCI_SCOTT_RPO_1_DHM.csv"))

#DHM calculations for NOAA dataset
SCOTT_RPO_1_DHM <- rep(0,nrow(NOAA_SCOTT_RPO_1))
SCOTT_RPO_1_negative_anomaly <- 0
for (i in 1:nrow(NOAA_SCOTT_RPO_1)){
  if(NOAA_SCOTT_RPO_1$anomaly[i] > 0) {
    SCOTT_RPO_1_negative_anomaly <- 
      SCOTT_RPO_1_negative_anomaly + NOAA_SCOTT_RPO_1$anomaly[i]
  } else {
    SCOTT_RPO_1_negative_anomaly <- 0
  }
  SCOTT_RPO_1_DHM[i] <- SCOTT_RPO_1_negative_anomaly
}

NOAA_SCOTT_RPO_1 <- NOAA_SCOTT_RPO_1 %>% 
  add_column(SCOTT_RPO_1_DHM)

write_csv(NOAA_SCOTT_RPO_1, here::here("data_raw/DHM/NOAA_SCOTT_RPO_1_DHM.csv"))

#DHM calculations for GCM dataset 
SCOTT_RPO_1_DHM <- rep(0,nrow(GCM_SCOTT_RPO_1))
SCOTT_RPO_1_negative_anomaly <- 0
for (i in 1:nrow(GCM_SCOTT_RPO_1)){
  if(GCM_SCOTT_RPO_1$anomaly[i] > 0) {
    SCOTT_RPO_1_negative_anomaly <- 
      SCOTT_RPO_1_negative_anomaly + GCM_SCOTT_RPO_1$anomaly[i]
  } else {
    SCOTT_RPO_1_negative_anomaly <- 0
  }
  SCOTT_RPO_1_DHM[i] <- SCOTT_RPO_1_negative_anomaly
}

GCM_SCOTT_RPO_1 <- GCM_SCOTT_RPO_1 %>% 
  add_column(SCOTT_RPO_1_DHM)

write_csv(GCM_SCOTT_RPO_1, here::here("data_raw/DHM/GCM_SCOTT_RPO_1_DHM.csv"))

#DHM calculations for Coral Core dataset
#no coral core at this site

#Combining datasets with DHM calculations
SCOTT_RPO_1_Combined <- rbind(CCI_SCOTT_RPO_1, NOAA_SCOTT_RPO_1, GCM_SCOTT_RPO_1)

#Cumulative Plot
SCOTT_RPO_1_cum_HSdays <- SCOTT_RPO_1_Combined %>% 
  select(monthly_date, Reef_Site, Data_Type, SCOTT_RPO_1_DHM) %>% 
  mutate(SCOTT_RPO_1_DHM = if_else(SCOTT_RPO_1_DHM > 1, 1, 0)) %>% 
  group_by(Data_Type) %>% 
  mutate(DHM_months_count = cumsum(SCOTT_RPO_1_DHM)) %>% 
  ungroup() %>% 
  select(-SCOTT_RPO_1_DHM) %>% 
  filter(monthly_date < "2021-01-01")

SCOTT_RPO_1_cum <- ggplot(SCOTT_RPO_1_cum_HSdays) +
  geom_smooth(aes(x = monthly_date, y = DHM_months_count, color = Data_Type)) + 
  labs(x = "Time", y = "Cumulative high DHM months", title = "SCOTT_RPO_1", color = "Data Type") 

SCOTT_RPO_1_cum

#DHM in descending order
#Max_DHM_CCI_SCOTT_RPO_1 <- CCI_SCOTT_RPO_1 %>% 
#  arrange(desc(SCOTT_RPO_1_DHM)) %>% 
#  select(date, SCOTT_RPO_1_DHM)
#Max_DHM_NOAA_SCOTT_RPO_1 <- NOAA_SCOTT_RPO_1 %>% 
#  arrange(desc(SCOTT_RPO_1_DHM)) %>% 
#  select(date, SCOTT_RPO_1_DHM)


#knitr::kable(list(Max_DHM_CCI_SCOTT_RPO_1, Max_DHM_NOAA_SCOTT_RPO_1), caption = "Degree Heating Month values in SCOTT\\_RPO\\_1 from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
SCOTT_RPO_1 <- SCOTT_RPO_1_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1998-01-01")), xmax = as.Date(c("1999-01-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2011-01-01")), xmax = as.Date(c("2012-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2013-01-01")), xmax = as.Date(c("2014-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2016-01-01")), xmax = as.Date(c("2017-01-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("1999-06-01"), y = Inf, label = "1998", hjust = 0, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2014-06-01"), y = Inf, label = "2013", hjust = 0.5, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  annotate(geom = "text", x = as.Date("2027-01-01"), y = Inf, label = "(S)NOAA>CCI>GCM", size = 3, vjust = 1)+
  geom_line(aes(x = monthly_date, y = SCOTT_RPO_1_DHM, color = Data_Type), alpha = 0.5, size = 1) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "Date", y = "Degree Heating Month", title = "(a) SCOTT_RPO_1 (-14.06, 121.78)", subtitle = "Scott Reef")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "none",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  )

#visualising in separate plots
SCOTT_RPO_1_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2012-06-01")), xmax = as.Date(c("2014-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = SCOTT_RPO_1_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "", y = "Degree Heating Month", title = "SCOTT_RPO_1 Degree Heating Month values time plot")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2), limits = c(0,10)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "bottom",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  ) +
  facet_wrap(~SCOTT_RPO_1_Combined$Data_Type)

ggsave("Supp_SCOTT_RPO_1_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)

```

\newpage
# **SCOTT_SL4** Degree Heating Months Time Series

```{r DHM_SCOTT_SL4, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
SCOTT_SL4_DHM <- rep(0,nrow(CCI_SCOTT_SL4))
SCOTT_SL4_negative_anomaly <- 0
for (i in 1:nrow(CCI_SCOTT_SL4)){
  if(CCI_SCOTT_SL4$anomaly[i] > 0) {
    SCOTT_SL4_negative_anomaly <- 
      SCOTT_SL4_negative_anomaly + CCI_SCOTT_SL4$anomaly[i]
  } else {
    SCOTT_SL4_negative_anomaly <- 0
  }
  SCOTT_SL4_DHM[i] <- SCOTT_SL4_negative_anomaly
}

CCI_SCOTT_SL4 <- CCI_SCOTT_SL4 %>% 
  add_column(SCOTT_SL4_DHM)

write_csv(CCI_SCOTT_SL4, here::here("data_raw/DHM/CCI_SCOTT_SL4_DHM.csv"))

#DHM calculations for NOAA dataset
SCOTT_SL4_DHM <- rep(0,nrow(NOAA_SCOTT_SL4))
SCOTT_SL4_negative_anomaly <- 0
for (i in 1:nrow(NOAA_SCOTT_SL4)){
  if(NOAA_SCOTT_SL4$anomaly[i] > 0) {
    SCOTT_SL4_negative_anomaly <- 
      SCOTT_SL4_negative_anomaly + NOAA_SCOTT_SL4$anomaly[i]
  } else {
    SCOTT_SL4_negative_anomaly <- 0
  }
  SCOTT_SL4_DHM[i] <- SCOTT_SL4_negative_anomaly
}

NOAA_SCOTT_SL4 <- NOAA_SCOTT_SL4 %>% 
  add_column(SCOTT_SL4_DHM)

write_csv(NOAA_SCOTT_SL4, here::here("data_raw/DHM/NOAA_SCOTT_SL4_DHM.csv"))

#DHM calculations for GCM dataset 
SCOTT_SL4_DHM <- rep(0,nrow(GCM_SCOTT_SL4))
SCOTT_SL4_negative_anomaly <- 0
for (i in 1:nrow(GCM_SCOTT_SL4)){
  if(GCM_SCOTT_SL4$anomaly[i] > 0) {
    SCOTT_SL4_negative_anomaly <- 
      SCOTT_SL4_negative_anomaly + GCM_SCOTT_SL4$anomaly[i]
  } else {
    SCOTT_SL4_negative_anomaly <- 0
  }
  SCOTT_SL4_DHM[i] <- SCOTT_SL4_negative_anomaly
}

GCM_SCOTT_SL4 <- GCM_SCOTT_SL4 %>% 
  add_column(SCOTT_SL4_DHM)

write_csv(GCM_SCOTT_SL4, here::here("data_raw/DHM/GCM_SCOTT_SL4_DHM.csv"))

#DHM calculations for Coral Core dataset
#no coral core at this site

#Combining datasets with DHM calculations
SCOTT_SL4_Combined <- rbind(CCI_SCOTT_SL4, NOAA_SCOTT_SL4, GCM_SCOTT_SL4)

#DHM in descending order
#Max_DHM_CCI_SCOTT_SL4 <- CCI_SCOTT_SL4 %>% 
#  arrange(desc(SCOTT_SL4_DHM)) %>% 
#  select(date, SCOTT_SL4_DHM)
#Max_DHM_NOAA_SCOTT_SL4 <- NOAA_SCOTT_SL4 %>% 
#  arrange(desc(SCOTT_SL4_DHM)) %>% 
#  select(date, SCOTT_SL4_DHM)


#knitr::kable(list(Max_DHM_CCI_SCOTT_SL4, Max_DHM_NOAA_SCOTT_SL4), caption = "Degree Heating Month values in SCOTT\\_SL4 from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
SCOTT_SL4 <- SCOTT_SL4_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2012-06-01")), xmax = as.Date(c("2014-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("1999-06-01"), y = Inf, label = "1998", hjust = 0, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2014-06-01"), y = Inf, label = "2013", hjust = 0.5, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  geom_line(aes(x = monthly_date, y = SCOTT_SL4_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "SCOTT_SL4 (-14.02, 121.86)")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  )



```

\newpage
# **SCOTT_SS3** Degree Heating Months Time Series

```{r DHM_SCOTT_SS3, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
SCOTT_SS3_DHM <- rep(0,nrow(CCI_SCOTT_SS3))
SCOTT_SS3_negative_anomaly <- 0
for (i in 1:nrow(CCI_SCOTT_SS3)){
  if(CCI_SCOTT_SS3$anomaly[i] > 0) {
    SCOTT_SS3_negative_anomaly <- 
      SCOTT_SS3_negative_anomaly + CCI_SCOTT_SS3$anomaly[i]
  } else {
    SCOTT_SS3_negative_anomaly <- 0
  }
  SCOTT_SS3_DHM[i] <- SCOTT_SS3_negative_anomaly
}

CCI_SCOTT_SS3 <- CCI_SCOTT_SS3 %>% 
  add_column(SCOTT_SS3_DHM)

write_csv(CCI_SCOTT_SS3, here::here("data_raw/DHM/CCI_SCOTT_SS3_DHM.csv"))

#DHM calculations for NOAA dataset
SCOTT_SS3_DHM <- rep(0,nrow(NOAA_SCOTT_SS3))
SCOTT_SS3_negative_anomaly <- 0
for (i in 1:nrow(NOAA_SCOTT_SS3)){
  if(NOAA_SCOTT_SS3$anomaly[i] > 0) {
    SCOTT_SS3_negative_anomaly <- 
      SCOTT_SS3_negative_anomaly + NOAA_SCOTT_SS3$anomaly[i]
  } else {
    SCOTT_SS3_negative_anomaly <- 0
  }
  SCOTT_SS3_DHM[i] <- SCOTT_SS3_negative_anomaly
}

NOAA_SCOTT_SS3 <- NOAA_SCOTT_SS3 %>% 
  add_column(SCOTT_SS3_DHM)

write_csv(NOAA_SCOTT_SS3, here::here("data_raw/DHM/NOAA_SCOTT_SS3_DHM.csv"))

#DHM calculations for GCM dataset 
SCOTT_SS3_DHM <- rep(0,nrow(GCM_SCOTT_SS3))
SCOTT_SS3_negative_anomaly <- 0
for (i in 1:nrow(GCM_SCOTT_SS3)){
  if(GCM_SCOTT_SS3$anomaly[i] > 0) {
    SCOTT_SS3_negative_anomaly <- 
      SCOTT_SS3_negative_anomaly + GCM_SCOTT_SS3$anomaly[i]
  } else {
    SCOTT_SS3_negative_anomaly <- 0
  }
  SCOTT_SS3_DHM[i] <- SCOTT_SS3_negative_anomaly
}

GCM_SCOTT_SS3 <- GCM_SCOTT_SS3 %>% 
  add_column(SCOTT_SS3_DHM)

write_csv(GCM_SCOTT_SS3, here::here("data_raw/DHM/GCM_SCOTT_SS3_DHM.csv"))

#DHM calculations for Coral Core dataset
#no coral core at this site

#Combining datasets with DHM calculations
SCOTT_SS3_Combined <- rbind(CCI_SCOTT_SS3, NOAA_SCOTT_SS3, GCM_SCOTT_SS3)

#DHM in descending order
#Max_DHM_CCI_SCOTT_SS3 <- CCI_SCOTT_SS3 %>% 
#  arrange(desc(SCOTT_SS3_DHM)) %>% 
#  select(date, SCOTT_SS3_DHM)
#Max_DHM_NOAA_SCOTT_SS3 <- NOAA_SCOTT_SS3 %>% 
#  arrange(desc(SCOTT_SS3_DHM)) %>% 
#  select(date, SCOTT_SS3_DHM)


#knitr::kable(list(Max_DHM_CCI_SCOTT_SS3, Max_DHM_NOAA_SCOTT_SS3), caption = "Degree Heating Month values in SCOTT\\_SS3 from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
SCOTT_SS3 <- SCOTT_SS3_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2012-06-01")), xmax = as.Date(c("2014-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("1999-06-01"), y = Inf, label = "1998", hjust = 0, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2014-06-01"), y = Inf, label = "2013", hjust = 0.5, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  geom_line(aes(x = monthly_date, y = SCOTT_SS3_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "SCOTT_SS3 (-13.64, 122.03)")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  )



```


\newpage
# **SCOTTNR1** Degree Heating Months Time Series

```{r DHM_SCOTTNR1, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
SCOTTNR1_DHM <- rep(0,nrow(CCI_SCOTTNR1))
SCOTTNR1_negative_anomaly <- 0
for (i in 1:nrow(CCI_SCOTTNR1)){
  if(CCI_SCOTTNR1$anomaly[i] > 0) {
    SCOTTNR1_negative_anomaly <- 
      SCOTTNR1_negative_anomaly + CCI_SCOTTNR1$anomaly[i]
  } else {
    SCOTTNR1_negative_anomaly <- 0
  }
  SCOTTNR1_DHM[i] <- SCOTTNR1_negative_anomaly
}

CCI_SCOTTNR1 <- CCI_SCOTTNR1 %>% 
  add_column(SCOTTNR1_DHM)

write_csv(CCI_SCOTTNR1, here::here("data_raw/DHM/CCI_SCOTTNR1_DHM.csv"))

#DHM calculations for NOAA dataset
SCOTTNR1_DHM <- rep(0,nrow(NOAA_SCOTTNR1))
SCOTTNR1_negative_anomaly <- 0
for (i in 1:nrow(NOAA_SCOTTNR1)){
  if(NOAA_SCOTTNR1$anomaly[i] > 0) {
    SCOTTNR1_negative_anomaly <- 
      SCOTTNR1_negative_anomaly + NOAA_SCOTTNR1$anomaly[i]
  } else {
    SCOTTNR1_negative_anomaly <- 0
  }
  SCOTTNR1_DHM[i] <- SCOTTNR1_negative_anomaly
}

NOAA_SCOTTNR1 <- NOAA_SCOTTNR1 %>% 
  add_column(SCOTTNR1_DHM)

write_csv(NOAA_SCOTTNR1, here::here("data_raw/DHM/NOAA_SCOTTNR1_DHM.csv"))

#DHM calculations for GCM dataset 
SCOTTNR1_DHM <- rep(0,nrow(GCM_SCOTTNR1))
SCOTTNR1_negative_anomaly <- 0
for (i in 1:nrow(GCM_SCOTTNR1)){
  if(GCM_SCOTTNR1$anomaly[i] > 0) {
    SCOTTNR1_negative_anomaly <- 
      SCOTTNR1_negative_anomaly + GCM_SCOTTNR1$anomaly[i]
  } else {
    SCOTTNR1_negative_anomaly <- 0
  }
  SCOTTNR1_DHM[i] <- SCOTTNR1_negative_anomaly
}

GCM_SCOTTNR1 <- GCM_SCOTTNR1 %>% 
  add_column(SCOTTNR1_DHM)

write_csv(GCM_SCOTTNR1, here::here("data_raw/DHM/GCM_SCOTTNR1_DHM.csv"))

#DHM calculations for Coral Core dataset
#no coral core at this site

#Combining datasets with DHM calculations
SCOTTNR1_Combined <- rbind(CCI_SCOTTNR1, NOAA_SCOTTNR1, GCM_SCOTTNR1)

#DHM in descending order
#Max_DHM_CCI_SCOTTNR1 <- CCI_SCOTTNR1 %>% 
#  arrange(desc(SCOTTNR1_DHM)) %>% 
#  select(date, SCOTTNR1_DHM)
#Max_DHM_NOAA_SCOTTNR1 <- NOAA_SCOTTNR1 %>% 
#  arrange(desc(SCOTTNR1_DHM)) %>% 
#  select(date, SCOTTNR1_DHM)


#knitr::kable(list(Max_DHM_CCI_SCOTTNR1, Max_DHM_NOAA_SCOTTNR1), caption = "Degree Heating Month values in SCOTTNR1 from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
SCOTTNR1 <- SCOTTNR1_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2012-06-01")), xmax = as.Date(c("2014-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("1999-06-01"), y = Inf, label = "1998", hjust = 0, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2014-06-01"), y = Inf, label = "2013", hjust = 0.5, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  geom_line(aes(x = monthly_date, y = SCOTTNR1_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "SCOTTNR1 (-13.99, 121.88)")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  )



```


\newpage
# **SCOTTSL1** Degree Heating Months Time Series

```{r DHM_SCOTTSL1, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
SCOTTSL1_DHM <- rep(0,nrow(CCI_SCOTTSL1))
SCOTTSL1_negative_anomaly <- 0
for (i in 1:nrow(CCI_SCOTTSL1)){
  if(CCI_SCOTTSL1$anomaly[i] > 0) {
    SCOTTSL1_negative_anomaly <- 
      SCOTTSL1_negative_anomaly + CCI_SCOTTSL1$anomaly[i]
  } else {
    SCOTTSL1_negative_anomaly <- 0
  }
  SCOTTSL1_DHM[i] <- SCOTTSL1_negative_anomaly
}

CCI_SCOTTSL1 <- CCI_SCOTTSL1 %>% 
  add_column(SCOTTSL1_DHM)

write_csv(CCI_SCOTTSL1, here::here("data_raw/DHM/CCI_SCOTTSL1_DHM.csv"))

#DHM calculations for NOAA dataset
SCOTTSL1_DHM <- rep(0,nrow(NOAA_SCOTTSL1))
SCOTTSL1_negative_anomaly <- 0
for (i in 1:nrow(NOAA_SCOTTSL1)){
  if(NOAA_SCOTTSL1$anomaly[i] > 0) {
    SCOTTSL1_negative_anomaly <- 
      SCOTTSL1_negative_anomaly + NOAA_SCOTTSL1$anomaly[i]
  } else {
    SCOTTSL1_negative_anomaly <- 0
  }
  SCOTTSL1_DHM[i] <- SCOTTSL1_negative_anomaly
}

NOAA_SCOTTSL1 <- NOAA_SCOTTSL1 %>% 
  add_column(SCOTTSL1_DHM)

write_csv(NOAA_SCOTTSL1, here::here("data_raw/DHM/NOAA_SCOTTSL1_DHM.csv"))

#DHM calculations for GCM dataset 
SCOTTSL1_DHM <- rep(0,nrow(GCM_SCOTTSL1))
SCOTTSL1_negative_anomaly <- 0
for (i in 1:nrow(GCM_SCOTTSL1)){
  if(GCM_SCOTTSL1$anomaly[i] > 0) {
    SCOTTSL1_negative_anomaly <- 
      SCOTTSL1_negative_anomaly + GCM_SCOTTSL1$anomaly[i]
  } else {
    SCOTTSL1_negative_anomaly <- 0
  }
  SCOTTSL1_DHM[i] <- SCOTTSL1_negative_anomaly
}

GCM_SCOTTSL1 <- GCM_SCOTTSL1 %>% 
  add_column(SCOTTSL1_DHM)

write_csv(GCM_SCOTTSL1, here::here("data_raw/DHM/GCM_SCOTTSL1_DHM.csv"))

#DHM calculations for Coral Core dataset
#no coral core at this site

#Combining datasets with DHM calculations
SCOTTSL1_Combined <- rbind(CCI_SCOTTSL1, NOAA_SCOTTSL1, GCM_SCOTTSL1)

#Cumulative Plot
SCOTTSL1_cum_HSdays <- SCOTTSL1_Combined %>% 
  select(monthly_date, Reef_Site, Data_Type, SCOTTSL1_DHM) %>% 
  mutate(SCOTTSL1_DHM = if_else(SCOTTSL1_DHM > 1, 1, 0)) %>% 
  group_by(Data_Type) %>% 
  mutate(DHM_months_count = cumsum(SCOTTSL1_DHM)) %>% 
  ungroup() %>% 
  select(-SCOTTSL1_DHM) %>% 
  filter(monthly_date < "2021-01-01")

SCOTTSL1_cum <- ggplot(SCOTTSL1_cum_HSdays) +
  geom_smooth(aes(x = monthly_date, y = DHM_months_count, color = Data_Type)) + 
  labs(x = "Time", y = "Cumulative high DHM months", title = "SCOTTSL1", color = "Data Type") 

SCOTTSL1_cum

#DHM in descending order
#Max_DHM_CCI_SCOTTSL1 <- CCI_SCOTTSL1 %>% 
#  arrange(desc(SCOTTSL1_DHM)) %>% 
#  select(date, SCOTTSL1_DHM)
#Max_DHM_NOAA_SCOTTSL1 <- NOAA_SCOTTSL1 %>% 
#  arrange(desc(SCOTTSL1_DHM)) %>% 
#  select(date, SCOTTSL1_DHM)


#knitr::kable(list(Max_DHM_CCI_SCOTTSL1, Max_DHM_NOAA_SCOTTSL1), caption = "Degree Heating Month values in SCOTTSL1 from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
SCOTTSL1 <- SCOTTSL1_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1998-01-01")), xmax = as.Date(c("1999-01-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2011-01-01")), xmax = as.Date(c("2012-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2013-01-01")), xmax = as.Date(c("2014-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2016-01-01")), xmax = as.Date(c("2017-01-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("1999-06-01"), y = Inf, label = "1998", hjust = 0, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2014-06-01"), y = Inf, label = "2013", hjust = 0.5, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  annotate(geom = "text", x = as.Date("2027-01-01"), y = Inf, label = "(S)NOAA>CCI>GCM", size = 3, vjust = 1)+
  geom_line(aes(x = monthly_date, y = SCOTTSL1_DHM, color = Data_Type), alpha = 0.5, size = 1) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "", y = "Degree Heating Month", title = "(b) SCOTTSL1 (-14.08, 121.95)", subtitle = "Scott Reef")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "none",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  )


#visualising in separate plots
SCOTTSL1_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2012-06-01")), xmax = as.Date(c("2014-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = SCOTTSL1_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "Date", y = "Degree Heating Month", title = "SCOTTSL1 Degree Heating Month values time plot")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2), limits = c(0,10)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "bottom",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  ) +
  facet_wrap(~SCOTTSL1_Combined$Data_Type)

ggsave("Supp_SCOTT_SL1_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)
 
```


\newpage
# **SCOTTSL2** Degree Heating Months Time Series

```{r DHM_SCOTTSL2, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
SCOTTSL2_DHM <- rep(0,nrow(CCI_SCOTTSL2))
SCOTTSL2_negative_anomaly <- 0
for (i in 1:nrow(CCI_SCOTTSL2)){
  if(CCI_SCOTTSL2$anomaly[i] > 0) {
    SCOTTSL2_negative_anomaly <- 
      SCOTTSL2_negative_anomaly + CCI_SCOTTSL2$anomaly[i]
  } else {
    SCOTTSL2_negative_anomaly <- 0
  }
  SCOTTSL2_DHM[i] <- SCOTTSL2_negative_anomaly
}

CCI_SCOTTSL2 <- CCI_SCOTTSL2 %>% 
  add_column(SCOTTSL2_DHM)

write_csv(CCI_SCOTTSL2, here::here("data_raw/DHM/CCI_SCOTTSL2_DHM.csv"))

#DHM calculations for NOAA dataset
SCOTTSL2_DHM <- rep(0,nrow(NOAA_SCOTTSL2))
SCOTTSL2_negative_anomaly <- 0
for (i in 1:nrow(NOAA_SCOTTSL2)){
  if(NOAA_SCOTTSL2$anomaly[i] > 0) {
    SCOTTSL2_negative_anomaly <- 
      SCOTTSL2_negative_anomaly + NOAA_SCOTTSL2$anomaly[i]
  } else {
    SCOTTSL2_negative_anomaly <- 0
  }
  SCOTTSL2_DHM[i] <- SCOTTSL2_negative_anomaly
}

NOAA_SCOTTSL2 <- NOAA_SCOTTSL2 %>% 
  add_column(SCOTTSL2_DHM)

write_csv(NOAA_SCOTTSL2, here::here("data_raw/DHM/NOAA_SCOTTSL2_DHM.csv"))

#DHM calculations for GCM dataset 
SCOTTSL2_DHM <- rep(0,nrow(GCM_SCOTTSL2))
SCOTTSL2_negative_anomaly <- 0
for (i in 1:nrow(GCM_SCOTTSL2)){
  if(GCM_SCOTTSL2$anomaly[i] > 0) {
    SCOTTSL2_negative_anomaly <- 
      SCOTTSL2_negative_anomaly + GCM_SCOTTSL2$anomaly[i]
  } else {
    SCOTTSL2_negative_anomaly <- 0
  }
  SCOTTSL2_DHM[i] <- SCOTTSL2_negative_anomaly
}

GCM_SCOTTSL2 <- GCM_SCOTTSL2 %>% 
  add_column(SCOTTSL2_DHM)

write_csv(GCM_SCOTTSL2, here::here("data_raw/DHM/GCM_SCOTTSL2_DHM.csv"))

#DHM calculations for Coral Core dataset
#no coral core at this site

#Combining datasets with DHM calculations
SCOTTSL2_Combined <- rbind(CCI_SCOTTSL2, NOAA_SCOTTSL2, GCM_SCOTTSL2)

#DHM in descending order
#Max_DHM_CCI_SCOTTSL2 <- CCI_SCOTTSL2 %>% 
#  arrange(desc(SCOTTSL2_DHM)) %>% 
#  select(date, SCOTTSL2_DHM)
#Max_DHM_NOAA_SCOTTSL2 <- NOAA_SCOTTSL2 %>% 
#  arrange(desc(SCOTTSL2_DHM)) %>% 
#  select(date, SCOTTSL2_DHM)


#knitr::kable(list(Max_DHM_CCI_SCOTTSL2, Max_DHM_NOAA_SCOTTSL2), caption = "Degree Heating Month values in SCOTTSL2 from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
SCOTTSL2 <- SCOTTSL2_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2012-06-01")), xmax = as.Date(c("2014-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("1999-06-01"), y = Inf, label = "1998", hjust = 0, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2014-06-01"), y = Inf, label = "2013", hjust = 0.5, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  geom_line(aes(x = monthly_date, y = SCOTTSL2_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "SCOTTSL2 (-14.19, 121.80)")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  )



```

\newpage
# **SCOTTSL3** Degree Heating Months Time Series

```{r DHM_SCOTTSL3, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
SCOTTSL3_DHM <- rep(0,nrow(CCI_SCOTTSL3))
SCOTTSL3_negative_anomaly <- 0
for (i in 1:nrow(CCI_SCOTTSL3)){
  if(CCI_SCOTTSL3$anomaly[i] > 0) {
    SCOTTSL3_negative_anomaly <- 
      SCOTTSL3_negative_anomaly + CCI_SCOTTSL3$anomaly[i]
  } else {
    SCOTTSL3_negative_anomaly <- 0
  }
  SCOTTSL3_DHM[i] <- SCOTTSL3_negative_anomaly
}

CCI_SCOTTSL3 <- CCI_SCOTTSL3 %>% 
  add_column(SCOTTSL3_DHM)

write_csv(CCI_SCOTTSL3, here::here("data_raw/DHM/CCI_SCOTTSL3_DHM.csv"))

#DHM calculations for NOAA dataset
SCOTTSL3_DHM <- rep(0,nrow(NOAA_SCOTTSL3))
SCOTTSL3_negative_anomaly <- 0
for (i in 1:nrow(NOAA_SCOTTSL3)){
  if(NOAA_SCOTTSL3$anomaly[i] > 0) {
    SCOTTSL3_negative_anomaly <- 
      SCOTTSL3_negative_anomaly + NOAA_SCOTTSL3$anomaly[i]
  } else {
    SCOTTSL3_negative_anomaly <- 0
  }
  SCOTTSL3_DHM[i] <- SCOTTSL3_negative_anomaly
}

NOAA_SCOTTSL3 <- NOAA_SCOTTSL3 %>% 
  add_column(SCOTTSL3_DHM)

write_csv(NOAA_SCOTTSL3, here::here("data_raw/DHM/NOAA_SCOTTSL3_DHM.csv"))

#DHM calculations for GCM dataset 
SCOTTSL3_DHM <- rep(0,nrow(GCM_SCOTTSL3))
SCOTTSL3_negative_anomaly <- 0
for (i in 1:nrow(GCM_SCOTTSL3)){
  if(GCM_SCOTTSL3$anomaly[i] > 0) {
    SCOTTSL3_negative_anomaly <- 
      SCOTTSL3_negative_anomaly + GCM_SCOTTSL3$anomaly[i]
  } else {
    SCOTTSL3_negative_anomaly <- 0
  }
  SCOTTSL3_DHM[i] <- SCOTTSL3_negative_anomaly
}

GCM_SCOTTSL3 <- GCM_SCOTTSL3 %>% 
  add_column(SCOTTSL3_DHM)

write_csv(GCM_SCOTTSL3, here::here("data_raw/DHM/GCM_SCOTTSL3_DHM.csv"))

#DHM calculations for Coral Core dataset
#no coral core at this site

#Combining datasets with DHM calculations
SCOTTSL3_Combined <- rbind(CCI_SCOTTSL3, NOAA_SCOTTSL3, GCM_SCOTTSL3)

#DHM in descending order
#Max_DHM_CCI_SCOTTSL3 <- CCI_SCOTTSL3 %>% 
#  arrange(desc(SCOTTSL3_DHM)) %>% 
#  select(date, SCOTTSL3_DHM)
#Max_DHM_NOAA_SCOTTSL3 <- NOAA_SCOTTSL3 %>% 
#  arrange(desc(SCOTTSL3_DHM)) %>% 
#  select(date, SCOTTSL3_DHM)


#knitr::kable(list(Max_DHM_CCI_SCOTTSL3, Max_DHM_NOAA_SCOTTSL3), caption = "Degree Heating Month values in SCOTTSL3 from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
SCOTTSL3 <- SCOTTSL3_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2012-06-01")), xmax = as.Date(c("2014-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("1999-06-01"), y = Inf, label = "1998", hjust = 0, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2014-06-01"), y = Inf, label = "2013", hjust = 0.5, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  geom_line(aes(x = monthly_date, y = SCOTTSL3_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "SCOTTSL3 (-14.07, 121.78)")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  )


 
```

\newpage
# **SCOTTSS1** Degree Heating Months Time Series

```{r DHM_SCOTTSS1, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
SCOTTSS1_DHM <- rep(0,nrow(CCI_SCOTTSS1))
SCOTTSS1_negative_anomaly <- 0
for (i in 1:nrow(CCI_SCOTTSS1)){
  if(CCI_SCOTTSS1$anomaly[i] > 0) {
    SCOTTSS1_negative_anomaly <- 
      SCOTTSS1_negative_anomaly + CCI_SCOTTSS1$anomaly[i]
  } else {
    SCOTTSS1_negative_anomaly <- 0
  }
  SCOTTSS1_DHM[i] <- SCOTTSS1_negative_anomaly
}

CCI_SCOTTSS1 <- CCI_SCOTTSS1 %>% 
  add_column(SCOTTSS1_DHM)

write_csv(CCI_SCOTTSS1, here::here("data_raw/DHM/CCI_SCOTTSS1_DHM.csv"))

#DHM calculations for NOAA dataset
SCOTTSS1_DHM <- rep(0,nrow(NOAA_SCOTTSS1))
SCOTTSS1_negative_anomaly <- 0
for (i in 1:nrow(NOAA_SCOTTSS1)){
  if(NOAA_SCOTTSS1$anomaly[i] > 0) {
    SCOTTSS1_negative_anomaly <- 
      SCOTTSS1_negative_anomaly + NOAA_SCOTTSS1$anomaly[i]
  } else {
    SCOTTSS1_negative_anomaly <- 0
  }
  SCOTTSS1_DHM[i] <- SCOTTSS1_negative_anomaly
}

NOAA_SCOTTSS1 <- NOAA_SCOTTSS1 %>% 
  add_column(SCOTTSS1_DHM)

write_csv(NOAA_SCOTTSS1, here::here("data_raw/DHM/NOAA_SCOTTSS1_DHM.csv"))

#DHM calculations for GCM dataset 
SCOTTSS1_DHM <- rep(0,nrow(GCM_SCOTTSS1))
SCOTTSS1_negative_anomaly <- 0
for (i in 1:nrow(GCM_SCOTTSS1)){
  if(GCM_SCOTTSS1$anomaly[i] > 0) {
    SCOTTSS1_negative_anomaly <- 
      SCOTTSS1_negative_anomaly + GCM_SCOTTSS1$anomaly[i]
  } else {
    SCOTTSS1_negative_anomaly <- 0
  }
  SCOTTSS1_DHM[i] <- SCOTTSS1_negative_anomaly
}

GCM_SCOTTSS1 <- GCM_SCOTTSS1 %>% 
  add_column(SCOTTSS1_DHM)

write_csv(GCM_SCOTTSS1, here::here("data_raw/DHM/GCM_SCOTTSS1_DHM.csv"))

#DHM calculations for Coral Core dataset
#no coral core at this site

#Combining datasets with DHM calculations
SCOTTSS1_Combined <- rbind(CCI_SCOTTSS1, NOAA_SCOTTSS1, GCM_SCOTTSS1)

#DHM in descending order
#Max_DHM_CCI_SCOTTSS1 <- CCI_SCOTTSS1 %>% 
#  arrange(desc(SCOTTSS1_DHM)) %>% 
#  select(date, SCOTTSS1_DHM)
#Max_DHM_NOAA_SCOTTSS1 <- NOAA_SCOTTSS1 %>% 
#  arrange(desc(SCOTTSS1_DHM)) %>% 
#  select(date, SCOTTSS1_DHM)


#knitr::kable(list(Max_DHM_CCI_SCOTTSS1, Max_DHM_NOAA_SCOTTSS1), caption = "Degree Heating Month values in SCOTTSS1 from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
SCOTTSS1 <- SCOTTSS1_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2012-06-01")), xmax = as.Date(c("2014-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("1999-06-01"), y = Inf, label = "1998", hjust = 0, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2014-06-01"), y = Inf, label = "2013", hjust = 0.5, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  geom_line(aes(x = monthly_date, y = SCOTTSS1_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "SCOTTSS1 (-14.08, 121.98)")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  )


 
```

\newpage
# **SCOTTSS2** Degree Heating Months Time Series

```{r DHM_SCOTTSS2, echo = FALSE, message = FALSE, warning = FALSE}



#DHM calculations for CCI dataset 
SCOTTSS2_DHM <- rep(0,nrow(CCI_SCOTTSS2))
SCOTTSS2_negative_anomaly <- 0
for (i in 1:nrow(CCI_SCOTTSS2)){
  if(CCI_SCOTTSS2$anomaly[i] > 0) {
    SCOTTSS2_negative_anomaly <- 
      SCOTTSS2_negative_anomaly + CCI_SCOTTSS2$anomaly[i]
  } else {
    SCOTTSS2_negative_anomaly <- 0
  }
  SCOTTSS2_DHM[i] <- SCOTTSS2_negative_anomaly
}

CCI_SCOTTSS2 <- CCI_SCOTTSS2 %>% 
  add_column(SCOTTSS2_DHM)

write_csv(CCI_SCOTTSS2, here::here("data_raw/DHM/CCI_SCOTTSS2_DHM.csv"))

#DHM calculations for NOAA dataset
SCOTTSS2_DHM <- rep(0,nrow(NOAA_SCOTTSS2))
SCOTTSS2_negative_anomaly <- 0
for (i in 1:nrow(NOAA_SCOTTSS2)){
  if(NOAA_SCOTTSS2$anomaly[i] > 0) {
    SCOTTSS2_negative_anomaly <- 
      SCOTTSS2_negative_anomaly + NOAA_SCOTTSS2$anomaly[i]
  } else {
    SCOTTSS2_negative_anomaly <- 0
  }
  SCOTTSS2_DHM[i] <- SCOTTSS2_negative_anomaly
}

NOAA_SCOTTSS2 <- NOAA_SCOTTSS2 %>% 
  add_column(SCOTTSS2_DHM)

write_csv(NOAA_SCOTTSS2, here::here("data_raw/DHM/NOAA_SCOTTSS2_DHM.csv"))

#DHM calculations for GCM dataset 
SCOTTSS2_DHM <- rep(0,nrow(GCM_SCOTTSS2))
SCOTTSS2_negative_anomaly <- 0
for (i in 1:nrow(GCM_SCOTTSS2)){
  if(GCM_SCOTTSS2$anomaly[i] > 0) {
    SCOTTSS2_negative_anomaly <- 
      SCOTTSS2_negative_anomaly + GCM_SCOTTSS2$anomaly[i]
  } else {
    SCOTTSS2_negative_anomaly <- 0
  }
  SCOTTSS2_DHM[i] <- SCOTTSS2_negative_anomaly
}

GCM_SCOTTSS2 <- GCM_SCOTTSS2 %>% 
  add_column(SCOTTSS2_DHM)

write_csv(GCM_SCOTTSS2, here::here("data_raw/DHM/GCM_SCOTTSS2_DHM.csv"))

#DHM calculations for Coral Core dataset
#no coral core at this site

#Combining datasets with DHM calculations
SCOTTSS2_Combined <- rbind(CCI_SCOTTSS2, NOAA_SCOTTSS2, GCM_SCOTTSS2)

#DHM in descending order
#Max_DHM_CCI_SCOTTSS2 <- CCI_SCOTTSS2 %>% 
#  arrange(desc(SCOTTSS2_DHM)) %>% 
#  select(date, SCOTTSS2_DHM)
#Max_DHM_NOAA_SCOTTSS2 <- NOAA_SCOTTSS2 %>% 
#  arrange(desc(SCOTTSS2_DHM)) %>% 
#  select(date, SCOTTSS2_DHM)


#knitr::kable(list(Max_DHM_CCI_SCOTTSS2, Max_DHM_NOAA_SCOTTSS2), caption = "Degree Heating Month values in SCOTTSS2 from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
SCOTTSS2 <- SCOTTSS2_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("1997-06-01")), xmax = as.Date(c("1999-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_rect(aes_string(xmin = as.Date(c("2012-06-01")), xmax = as.Date(c("2014-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
   geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("1999-06-01"), y = Inf, label = "1998", hjust = 0, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2014-06-01"), y = Inf, label = "2013", hjust = 0.5, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  geom_line(aes(x = monthly_date, y = SCOTTSS2_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "SCOTTSS2 (-13.92, 121.92)")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  )



```

\newpage
# **Bundegi** Degree Heating Months Time Series

```{r DHM_Bundegi_13BND_08BND, echo = FALSE, message = FALSE, warning = FALSE}

#DHM calculations for 13BND CCI dataset 
Bundegi_DHM <- rep(0,nrow(CCI_Bundegi_13BND))
Bundegi_negative_anomaly <- 0
for (i in 1:nrow(CCI_Bundegi_13BND)){
  if(CCI_Bundegi_13BND$anomaly[i] > 0) {
    Bundegi_negative_anomaly <- 
      Bundegi_negative_anomaly + CCI_Bundegi_13BND$anomaly[i]
  } else {
    Bundegi_negative_anomaly <- 0
  }
  Bundegi_DHM[i] <- Bundegi_negative_anomaly
}

CCI_Bundegi_13BND <- CCI_Bundegi_13BND %>% 
  add_column(Bundegi_DHM)

write_csv(CCI_Bundegi_13BND, here::here("data_raw/DHM/CCI_Bundegi_13BND_DHM.csv"))


#DHM calculations for 13BND NOAA dataset
Bundegi_DHM <- rep(0,nrow(NOAA_Bundegi_13BND))
Bundegi_negative_anomaly <- 0
for (i in 1:nrow(NOAA_Bundegi_13BND)){
  if(NOAA_Bundegi_13BND$anomaly[i] > 0) {
    Bundegi_negative_anomaly <- 
      Bundegi_negative_anomaly + NOAA_Bundegi_13BND$anomaly[i]
  } else {
    Bundegi_negative_anomaly <- 0
  }
  Bundegi_DHM[i] <- Bundegi_negative_anomaly
}

NOAA_Bundegi_13BND <- NOAA_Bundegi_13BND %>% 
  add_column(Bundegi_DHM) %>% 
  mutate(Reef_Site = replace(Reef_Site, Reef_Site == "Bundegi (13BND)", "13BND"))

write_csv(NOAA_Bundegi_13BND, here::here("data_raw/DHM/NOAA_Bundegi_13BND_DHM.csv"))

#DHM calculations for 13BND GCM dataset 
Bundegi_DHM <- rep(0,nrow(GCM_Bundegi_13BND))
Bundegi_negative_anomaly <- 0
for (i in 1:nrow(GCM_Bundegi_13BND)){
  if(GCM_Bundegi_13BND$anomaly[i] > 0) {
    Bundegi_negative_anomaly <- 
      Bundegi_negative_anomaly + GCM_Bundegi_13BND$anomaly[i]
  } else {
    Bundegi_negative_anomaly <- 0
  }
  Bundegi_DHM[i] <- Bundegi_negative_anomaly
}

GCM_Bundegi_13BND <- GCM_Bundegi_13BND %>% 
  add_column(Bundegi_DHM)

write_csv(GCM_Bundegi_13BND, here::here("data_raw/DHM/GCM_Bundegi_13BND_DHM.csv"))


#DHM calculations for 13BND Coral Core (CCI) dataset
`13BND_DHM` <- rep(0,nrow(CCore_13BND_CCI))
`13BND_negative_anomaly` <- 0
for (i in 1:nrow(CCore_13BND_CCI)){
  if(CCore_13BND_CCI$anomaly[i] > 0) {
    `13BND_negative_anomaly` <- 
      `13BND_negative_anomaly` + CCore_13BND_CCI$anomaly[i]
  } else {
    `13BND_negative_anomaly` <- 0
  }
  `13BND_DHM`[i] <- `13BND_negative_anomaly`
}

CCore_13BND_CCI <- CCore_13BND_CCI %>% 
  add_column(`13BND_DHM`) %>% 
  mutate(`13BND_DHM` = if_else(is.na(sst_monthly), NA_real_ , `13BND_DHM`)) %>% 
  rename(Bundegi_DHM = `13BND_DHM`)

write_csv(CCore_13BND_CCI, here::here("data_raw/DHM/CCore_13BND_CCI_DHM.csv"))

#DHM calculations for 13BND Coral Core (NOAA) dataset
`13BND_DHM` <- rep(0,nrow(CCore_13BND_NOAA))
`13BND_negative_anomaly` <- 0
for (i in 1:nrow(CCore_13BND_NOAA)){
  if(CCore_13BND_NOAA$anomaly[i] > 0) {
    `13BND_negative_anomaly` <- 
      `13BND_negative_anomaly` + CCore_13BND_NOAA$anomaly[i]
  } else {
    `13BND_negative_anomaly` <- 0
  }
  `13BND_DHM`[i] <- `13BND_negative_anomaly`
}

CCore_13BND_NOAA <- CCore_13BND_NOAA %>% 
  add_column(`13BND_DHM`) %>% 
  mutate(`13BND_DHM` = if_else(is.na(sst_monthly), NA_real_ , `13BND_DHM`)) %>% 
  rename(Bundegi_DHM = `13BND_DHM`)

write_csv(CCore_13BND_NOAA, here::here("data_raw/DHM/CCore_13BND_NOAA_DHM.csv"))

#Combining datasets with DHM calculations for Bundegi 13BND
Bundegi_13BND_Combined <- rbind(CCI_Bundegi_13BND, NOAA_Bundegi_13BND, GCM_Bundegi_13BND, CCore_13BND_CCI, CCore_13BND_NOAA)
Bundegi_13BND_Combined_noCC <- rbind(CCI_Bundegi_13BND, NOAA_Bundegi_13BND, GCM_Bundegi_13BND)


#DHM calculations for 08BND CCI dataset 
Bundegi_DHM <- rep(0,nrow(CCI_Bundegi_08BND))
Bundegi_negative_anomaly <- 0
for (i in 1:nrow(CCI_Bundegi_08BND)){
  if(CCI_Bundegi_08BND$anomaly[i] > 0) {
    Bundegi_negative_anomaly <- 
      Bundegi_negative_anomaly + CCI_Bundegi_08BND$anomaly[i]
  } else {
    Bundegi_negative_anomaly <- 0
  }
  Bundegi_DHM[i] <- Bundegi_negative_anomaly
}

CCI_Bundegi_08BND <- CCI_Bundegi_08BND %>% 
  add_column(Bundegi_DHM)

write_csv(CCI_Bundegi_08BND, here::here("data_raw/DHM/CCI_Bundegi_08BND_DHM.csv"))

#DHM calculations for 08BND NOAA dataset
Bundegi_DHM <- rep(0,nrow(NOAA_Bundegi_08BND))
Bundegi_negative_anomaly <- 0
for (i in 1:nrow(NOAA_Bundegi_08BND)){
  if(NOAA_Bundegi_08BND$anomaly[i] > 0) {
    Bundegi_negative_anomaly <- 
      Bundegi_negative_anomaly + NOAA_Bundegi_08BND$anomaly[i]
  } else {
    Bundegi_negative_anomaly <- 0
  }
  Bundegi_DHM[i] <- Bundegi_negative_anomaly
}

NOAA_Bundegi_08BND <- NOAA_Bundegi_08BND %>% 
  add_column(Bundegi_DHM) %>% 
  mutate(Reef_Site = replace(Reef_Site, Reef_Site == "Bundegi (13BND)", "08BND"))

write_csv(NOAA_Bundegi_08BND, here::here("data_raw/DHM/NOAA_Bundegi_08BND_DHM.csv"))

#DHM calculations for 08BND GCM dataset 
Bundegi_DHM <- rep(0,nrow(GCM_Bundegi_08BND))
Bundegi_negative_anomaly <- 0
for (i in 1:nrow(GCM_Bundegi_08BND)){
  if(GCM_Bundegi_08BND$anomaly[i] > 0) {
    Bundegi_negative_anomaly <- 
      Bundegi_negative_anomaly + GCM_Bundegi_08BND$anomaly[i]
  } else {
    Bundegi_negative_anomaly <- 0
  }
  Bundegi_DHM[i] <- Bundegi_negative_anomaly
}

GCM_Bundegi_08BND <- GCM_Bundegi_08BND %>% 
  add_column(Bundegi_DHM)

write_csv(GCM_Bundegi_08BND, here::here("data_raw/DHM/GCM_Bundegi_08BND_DHM.csv"))

#DHM calculations for 08BND Coral Core (CCI) dataset
`08BND_DHM` <- rep(0,nrow(CCore_08BND_CCI))
`08BND_negative_anomaly` <- 0
for (i in 1:nrow(CCore_08BND_CCI)){
  if(CCore_08BND_CCI$anomaly[i] > 0) {
    `08BND_negative_anomaly` <- 
      `08BND_negative_anomaly` + CCore_08BND_CCI$anomaly[i]
  } else {
    `08BND_negative_anomaly` <- 0
  }
  `08BND_DHM`[i] <- `08BND_negative_anomaly`
}

CCore_08BND_CCI <- CCore_08BND_CCI %>% 
  add_column(`08BND_DHM`) %>% 
  mutate(`08BND_DHM` = if_else(is.na(sst_monthly), NA_real_ , `08BND_DHM`)) %>% 
  rename(Bundegi_DHM = `08BND_DHM`)

write_csv(CCore_08BND_CCI, here::here("data_raw/DHM/CCore_08BND_CCI_DHM.csv"))

#DHM calculations for 08BND Coral Core (NOAA) dataset

`08BND_DHM` <- rep(0,nrow(CCore_08BND_NOAA))
`08BND_negative_anomaly` <- 0
for (i in 1:nrow(CCore_08BND_NOAA)){
  if(CCore_08BND_NOAA$anomaly[i] > 0) {
    `08BND_negative_anomaly` <- 
      `08BND_negative_anomaly` + CCore_08BND_NOAA$anomaly[i]
  } else {
    `08BND_negative_anomaly` <- 0
  }
  `08BND_DHM`[i] <- `08BND_negative_anomaly`
}

CCore_08BND_NOAA <- CCore_08BND_NOAA %>% 
  add_column(`08BND_DHM`) %>% 
  mutate(`08BND_DHM` = if_else(is.na(sst_monthly), NA_real_ , `08BND_DHM`)) %>% 
  rename(Bundegi_DHM = `08BND_DHM`)

write_csv(CCore_08BND_NOAA, here::here("data_raw/DHM/CCore_08BND_NOAA_DHM.csv"))

#Combining datasets with DHM calculations
Bundegi_08BND_Combined <- rbind(CCI_Bundegi_08BND, NOAA_Bundegi_08BND, GCM_Bundegi_08BND, CCore_08BND_CCI, CCore_08BND_NOAA)
Bundegi_08BND_Combined_noCC <- rbind(CCI_Bundegi_08BND, NOAA_Bundegi_08BND, GCM_Bundegi_08BND)

#Cumulative Plot (08BND)
Bundegi_08BND_cum_HSdays <- Bundegi_08BND_Combined_noCC %>% 
  select(monthly_date, Reef_Site, Data_Type, Bundegi_DHM) %>% 
  mutate(Bundegi_DHM = if_else(Bundegi_DHM > 1, 1, 0)) %>% 
  group_by(Data_Type) %>% 
  mutate(DHM_months_count = cumsum(Bundegi_DHM)) %>% 
  ungroup() %>% 
  select(-Bundegi_DHM) %>% 
  filter(monthly_date < "2021-01-01")

Bundegi_08BND_cum <- ggplot(Bundegi_08BND_cum_HSdays) +
  geom_smooth(aes(x = monthly_date, y = DHM_months_count, color = Data_Type)) + 
  labs(x = "Time", y = "Cumulative high DHM months", title = "Bundegi 08BND", color = "Data Type") 

Bundegi_08BND_cum

#Cumulative Plot (13BND)
Bundegi_13BND_cum_HSdays <- Bundegi_13BND_Combined_noCC %>% 
  select(monthly_date, Reef_Site, Data_Type, Bundegi_DHM) %>% 
  mutate(Bundegi_DHM = if_else(Bundegi_DHM > 1, 1, 0)) %>% 
  group_by(Data_Type) %>% 
  mutate(DHM_months_count = cumsum(Bundegi_DHM)) %>% 
  ungroup() %>% 
  select(-Bundegi_DHM) %>% 
  filter(monthly_date < "2021-01-01")

Bundegi_13BND_cum <- ggplot(Bundegi_13BND_cum_HSdays) +
  geom_smooth(aes(x = monthly_date, y = DHM_months_count, color = Data_Type)) + 
  labs(x = "Time", y = "Cumulative high DHM months", title = "Bundegi 13BND", color = "Data Type") 

Bundegi_13BND_cum

#DHM in descending order
#Max_DHM_CCI_Bundegi <- CCI_Bundegi %>% 
#  arrange(desc(Bundegi_DHM)) %>% 
#  select(date, Bundegi_DHM)
#Max_DHM_NOAA_Bundegi <- NOAA_Bundegi %>% 
#  arrange(desc(Bundegi_DHM)) %>% 
#  select(date, Bundegi_DHM)


#knitr::kable(list(Max_DHM_CCI_Bundegi, Max_DHM_NOAA_Bundegi), caption = "Degree Heating Month values in 08BND and 13BND from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore - 08BND
`08BND` <- Bundegi_08BND_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2011-01-01")), xmax = as.Date(c("2012-01-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
    geom_rect(aes_string(xmin = as.Date(c("2016-01-01")), xmax = as.Date(c("2017-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  annotate(geom = "text", x = as.Date("2027-01-01"), y = Inf, label = "(M)CCI>NOAA>GCM\n(S)CCI>NOAA>GCM", size = 3, vjust = 1)+
  geom_line(aes(x = monthly_date, y = Bundegi_DHM, color = Data_Type), alpha = 0.5, size = 1) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "Time", y = "Degree Heating Month", title = "(c) 08BND (-21.87, 114.16)", subtitle = "Ningaloo Reef")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "bottom",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  )

#visualising in separate plots
Bundegi_08BND_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
    geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = Bundegi_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "08BND Degree Heating Month values time plot")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank(),
        panel.background = element_blank(),
  ) +
  facet_wrap(~Bundegi_08BND_Combined$Data_Type)

ggsave("Supp_08BND_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)


#Visualising DHM values in CCI, NOAA, GCM and CCore - 13BND
`13BND` <- Bundegi_13BND_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2011-01-01")), xmax = as.Date(c("2012-01-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
    geom_rect(aes_string(xmin = as.Date(c("2016-01-01")), xmax = as.Date(c("2017-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  annotate(geom = "text", x = as.Date("2027-01-01"), y = Inf, label = "(M)CCI>NOAA>GCM\n(S)CCI>NOAA>GCM", size = 3, vjust = 1)+
  geom_line(aes(x = monthly_date, y = Bundegi_DHM, color = Data_Type), alpha = 0.5, size = 1) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "", y = "Degree Heating Month", title = "(d) 13BND (-21.87, 114.16)", subtitle = "Ningaloo Reef")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "none",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  )

#visualising in separate plots
Bundegi_13BND_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
    geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = Bundegi_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "13BND Degree Heating Month values time plot")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  ) +
  facet_wrap(~Bundegi_13BND_Combined$Data_Type)

ggsave("Supp_13BND_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)
```



\newpage
# **Tantabiddi 08TNT** Degree Heating Months Time Series

```{r DHM_Tantabiddi_08TNT, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
Tantabiddi_DHM <- rep(0,nrow(CCI_Tantabiddi_08TNT))
Tantabiddi_negative_anomaly <- 0
for (i in 1:nrow(CCI_Tantabiddi_08TNT)){
  if(CCI_Tantabiddi_08TNT$anomaly[i] > 0) {
    Tantabiddi_negative_anomaly <- 
      Tantabiddi_negative_anomaly + CCI_Tantabiddi_08TNT$anomaly[i]
  } else {
    Tantabiddi_negative_anomaly <- 0
  }
  Tantabiddi_DHM[i] <- Tantabiddi_negative_anomaly
}

CCI_Tantabiddi_08TNT <- CCI_Tantabiddi_08TNT %>%
  add_column(Tantabiddi_DHM)

write_csv(CCI_Tantabiddi_08TNT, here::here("data_raw/DHM/CCI_Tantabiddi_08TNT_DHM.csv"))

#DHM calculations for NOAA dataset
Tantabiddi_DHM <- rep(0,nrow(NOAA_Tantabiddi_08TNT))
Tantabiddi_negative_anomaly <- 0
for (i in 1:nrow(NOAA_Tantabiddi_08TNT)){
  if(NOAA_Tantabiddi_08TNT$anomaly[i] > 0) {
    Tantabiddi_negative_anomaly <- 
      Tantabiddi_negative_anomaly + NOAA_Tantabiddi_08TNT$anomaly[i]
  } else {
    Tantabiddi_negative_anomaly <- 0
  }
  Tantabiddi_DHM[i] <- Tantabiddi_negative_anomaly
}

NOAA_Tantabiddi_08TNT <- NOAA_Tantabiddi_08TNT %>% 
  add_column(Tantabiddi_DHM)

write_csv(NOAA_Tantabiddi_08TNT, here::here("data_raw/DHM/NOAA_Tantabiddi_08TNT_DHM.csv"))

#DHM calculations for GCM dataset 
Tantabiddi_DHM <- rep(0,nrow(GCM_Tantabiddi_08TNT))
Tantabiddi_negative_anomaly <- 0
for (i in 1:nrow(GCM_Tantabiddi_08TNT)){
  if(GCM_Tantabiddi_08TNT$anomaly[i] > 0) {
    Tantabiddi_negative_anomaly <- 
      Tantabiddi_negative_anomaly + GCM_Tantabiddi_08TNT$anomaly[i]
  } else {
    Tantabiddi_negative_anomaly <- 0
  }
  Tantabiddi_DHM[i] <- Tantabiddi_negative_anomaly
}

GCM_Tantabiddi_08TNT <- GCM_Tantabiddi_08TNT %>%
  add_column(Tantabiddi_DHM)

write_csv(GCM_Tantabiddi_08TNT, here::here("data_raw/DHM/GCM_Tantabiddi_08TNT_DHM.csv"))

#DHM calculations for Coral Core (CCI) dataset
`08TNT_DHM` <- rep(0,nrow(CCore_08TNT_CCI))
`08TNT_negative_anomaly` <- 0
for (i in 1:nrow(CCore_08TNT_CCI)){
  if(CCore_08TNT_CCI$anomaly[i] > 0) {
    `08TNT_negative_anomaly` <- 
      `08TNT_negative_anomaly` + CCore_08TNT_CCI$anomaly[i]
  } else {
    `08TNT_negative_anomaly` <- 0
  }
  `08TNT_DHM`[i] <- `08TNT_negative_anomaly`
}

CCore_08TNT_CCI <- CCore_08TNT_CCI %>% 
  add_column(`08TNT_DHM`) %>% 
  mutate(`08TNT_DHM` = if_else(is.na(sst_monthly), NA_real_ , `08TNT_DHM`)) %>% 
  rename(Tantabiddi_DHM = `08TNT_DHM`)

write_csv(CCore_08TNT_CCI, here::here("data_raw/DHM/CCore_08TNT_CCI_DHM.csv"))

#DHM calculations for Coral Core (NOAA) dataset
`08TNT_DHM` <- rep(0,nrow(CCore_08TNT_NOAA))
`08TNT_negative_anomaly` <- 0
for (i in 1:nrow(CCore_08TNT_NOAA)){
  if(CCore_08TNT_NOAA$anomaly[i] > 0) {
   ` 08TNT_negative_anomaly` <- 
      `08TNT_negative_anomaly` + CCore_08TNT_NOAA$anomaly[i]
  } else {
    `08TNT_negative_anomaly` <- 0
  }
 `08TNT_DHM`[i] <- `08TNT_negative_anomaly`
}

CCore_08TNT_NOAA <- CCore_08TNT_NOAA %>% 
  add_column(`08TNT_DHM`) %>% 
  mutate(`08TNT_DHM` = if_else(is.na(sst_monthly), NA_real_ , `08TNT_DHM`)) %>% 
  rename(Tantabiddi_DHM = `08TNT_DHM`)

write_csv(CCore_08TNT_NOAA, here::here("data_raw/DHM/CCore_08TNT_NOAA_DHM.csv"))

#Combining datasets with DHM calculations
Tantabiddi_08TNT_Combined <- rbind(CCI_Tantabiddi_08TNT, NOAA_Tantabiddi_08TNT, GCM_Tantabiddi_08TNT, CCore_08TNT_CCI, CCore_08TNT_NOAA)

Tantabiddi_08TNT_Combined_noCC <- rbind(CCI_Tantabiddi_08TNT, NOAA_Tantabiddi_08TNT, GCM_Tantabiddi_08TNT)

#Cumulative Plot
Tantabiddi_08TNT_cum_HSdays <- Tantabiddi_08TNT_Combined_noCC %>% 
  select(monthly_date, Reef_Site, Data_Type, Tantabiddi_DHM) %>% 
  mutate(Tantabiddi_DHM = if_else(Tantabiddi_DHM > 1, 1, 0)) %>% 
  group_by(Data_Type) %>% 
  mutate(DHM_months_count = cumsum(Tantabiddi_DHM)) %>% 
  ungroup() %>% 
  select(-Tantabiddi_DHM) %>% 
  filter(monthly_date < "2021-01-01")

Tantabiddi_08TNT_cum <- ggplot(Tantabiddi_08TNT_cum_HSdays) +
  geom_smooth(aes(x = monthly_date, y = DHM_months_count, color = Data_Type)) + 
  labs(x = "Time", y = "Cumulative high DHM months", title = "Tantabiddi 08TNT", color = "Data Type") 

Tantabiddi_08TNT_cum

#DHM >= 1
High_08TNT_DHM <- Tantabiddi_08TNT_Combined %>% 
  filter(Tantabiddi_DHM >= 1) %>% 
  select(monthly_date, Reef_Site, Data_Type, Tantabiddi_DHM) %>% 
  mutate(monthly_date = yearmonth(monthly_date)) %>% 
  pivot_wider(names_from = Data_Type, values_from = Tantabiddi_DHM) %>% 
  arrange(-desc(monthly_date)) %>% 
  rename(Date = monthly_date, Site = Reef_Site)

#color.me <- which(High_08TNT_DHM$`Coral Core (CCI)`> 0 | High_08TNT_DHM$`Coral Core (NOAA)` >0)

#kbl(High_08TNT_DHM, longtable = T, caption = "Coral Core Date Range is from 1996 to 2008") %>% 
#  kable_styling(position = "center", latex_options = c("repeat_header")) %>% 
#  add_header_above(c(" " = 2, "Degree Heating Month Values in 08TNT" = 2), bold = TRUE) #%>% 
#  row_spec(color.me, color = "red")

#Visualising DHM values in CCI, NOAA, GCM and CCore 
`08TNT` <- Tantabiddi_08TNT_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2011-01-01")), xmax = as.Date(c("2012-01-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
    geom_rect(aes_string(xmin = as.Date(c("2016-01-01")), xmax = as.Date(c("2017-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  geom_line(aes(x = monthly_date, y = Tantabiddi_DHM, color = Data_Type), alpha = 0.5, size = 1) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "", y = "Degree Heating Month", title = "(e) 08TNT (-21.91, 113.97)", subtitle = "Ningaloo Reef")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "none",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  )

#visualising in separate plots
Tantabiddi_08TNT_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
    geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = Tantabiddi_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "08TNT Degree Heating Month values time plot")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  ) +
  facet_wrap(~Tantabiddi_08TNT_Combined$Data_Type)

ggsave("Supp_08TNT_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)
 
```

\newpage
# **Tantabiddi 13TNT** Degree Heating Months Time Series
```{r DHM_Tantabiddi_13TNT, echo = FALSE, message = FALSE, warning = FALSE}

#DHM calculations for CCI dataset 
Tantabiddi_DHM <- rep(0,nrow(CCI_Tantabiddi_13TNT))
Tantabiddi_negative_anomaly <- 0
for (i in 1:nrow(CCI_Tantabiddi_13TNT)){
  if(CCI_Tantabiddi_13TNT$anomaly[i] > 0) {
    Tantabiddi_negative_anomaly <- 
      Tantabiddi_negative_anomaly + CCI_Tantabiddi_13TNT$anomaly[i]
  } else {
    Tantabiddi_negative_anomaly <- 0
  }
  Tantabiddi_DHM[i] <- Tantabiddi_negative_anomaly
}

CCI_Tantabiddi_13TNT <- CCI_Tantabiddi_13TNT %>%
  add_column(Tantabiddi_DHM) %>% 
  rename(`13TNT_DHM` = Tantabiddi_DHM)

write_csv(CCI_Tantabiddi_13TNT, here::here("data_raw/DHM/CCI_Tantabiddi_13TNT_DHM.csv"))

#DHM calculations for NOAA dataset
Tantabiddi_DHM <- rep(0,nrow(NOAA_Tantabiddi_13TNT))
Tantabiddi_negative_anomaly <- 0
for (i in 1:nrow(NOAA_Tantabiddi_13TNT)){
  if(NOAA_Tantabiddi_13TNT$anomaly[i] > 0) {
    Tantabiddi_negative_anomaly <- 
      Tantabiddi_negative_anomaly + NOAA_Tantabiddi_13TNT$anomaly[i]
  } else {
    Tantabiddi_negative_anomaly <- 0
  }
  Tantabiddi_DHM[i] <- Tantabiddi_negative_anomaly
}

NOAA_Tantabiddi_13TNT <- NOAA_Tantabiddi_13TNT %>% 
  add_column(Tantabiddi_DHM) %>% 
  rename(`13TNT_DHM` = Tantabiddi_DHM)

write_csv(NOAA_Tantabiddi_13TNT, here::here("data_raw/DHM/NOAA_Tantabiddi_13TNT_DHM.csv"))

#DHM calculations for GCM dataset 
Tantabiddi_DHM <- rep(0,nrow(CCI_Tantabiddi_13TNT))
Tantabiddi_negative_anomaly <- 0
for (i in 1:nrow(GCM_Tantabiddi_13TNT)){
  if(GCM_Tantabiddi_13TNT$anomaly[i] > 0) {
    Tantabiddi_negative_anomaly <- 
      Tantabiddi_negative_anomaly + GCM_Tantabiddi_13TNT$anomaly[i]
  } else {
    Tantabiddi_negative_anomaly <- 0
  }
  Tantabiddi_DHM[i] <- Tantabiddi_negative_anomaly
}

GCM_Tantabiddi_13TNT <- GCM_Tantabiddi_13TNT %>%
  add_column(Tantabiddi_DHM) %>% 
  rename(`13TNT_DHM` = Tantabiddi_DHM)

write_csv(GCM_Tantabiddi_13TNT, here::here("data_raw/DHM/GCM_Tantabiddi_13TNT_DHM.csv"))

#DHM calculations for Coral Core (CCI) dataset
`13TNT_DHM` <- rep(0,nrow(CCore_13TNT_CCI))
`13TNT_negative_anomaly` <- 0
for (i in 1:nrow(CCore_13TNT_CCI)){
  if(CCore_13TNT_CCI$anomaly[i] > 0) {
    `13TNT_negative_anomaly` <- 
      `13TNT_negative_anomaly` + CCore_13TNT_CCI$anomaly[i]
  } else {
    `13TNT_negative_anomaly` <- 0
  }
  `13TNT_DHM`[i] <- `13TNT_negative_anomaly`
}

CCore_13TNT_CCI <- CCore_13TNT_CCI %>% 
  add_column(`13TNT_DHM`) %>% 
  mutate(`13TNT_DHM` = if_else(is.na(sst_monthly), NA_real_ , `13TNT_DHM`)) 

write_csv(CCore_13TNT_CCI, here::here("data_raw/DHM/CCore_13TNT_CCI_DHM.csv"))

#DHM calculations for Coral Core (NOAA) dataset
`13TNT_DHM` <- rep(0,nrow(CCore_13TNT_NOAA))
`13TNT_negative_anomaly` <- 0
for (i in 1:nrow(CCore_13TNT_NOAA)){
  if(CCore_13TNT_NOAA$anomaly[i] > 0) {
   ` 13TNT_negative_anomaly` <- 
      `13TNT_negative_anomaly` + CCore_13TNT_NOAA$anomaly[i]
  } else {
    `13TNT_negative_anomaly` <- 0
  }
 `13TNT_DHM`[i] <- `13TNT_negative_anomaly`
}

CCore_13TNT_NOAA <- CCore_13TNT_NOAA %>% 
  add_column(`13TNT_DHM`) %>% 
  mutate(`13TNT_DHM` = if_else(is.na(sst_monthly), NA_real_ , `13TNT_DHM`)) 

write_csv(CCore_13TNT_NOAA, here::here("data_raw/DHM/CCore_13TNT_NOAA_DHM.csv"))

#Combining datasets with DHM calculations
Tantabiddi_13TNT_Combined <- rbind(CCI_Tantabiddi_13TNT, NOAA_Tantabiddi_13TNT, GCM_Tantabiddi_13TNT, CCore_13TNT_CCI, CCore_13TNT_NOAA)

Tantabiddi_13TNT_Combined_noCC <- rbind(CCI_Tantabiddi_13TNT, NOAA_Tantabiddi_13TNT, GCM_Tantabiddi_13TNT)

#Cumulative Plot
Tantabiddi_13TNT_cum_HSdays <- Tantabiddi_13TNT_Combined_noCC %>% 
  rename(Tantabiddi_DHM = `13TNT_DHM`) %>% 
  select(monthly_date, Reef_Site, Data_Type, Tantabiddi_DHM) %>% 
  mutate(Tantabiddi_DHM = if_else(Tantabiddi_DHM > 1, 1, 0)) %>% 
  group_by(Data_Type) %>% 
  mutate(DHM_months_count = cumsum(Tantabiddi_DHM)) %>% 
  ungroup() %>% 
  select(-Tantabiddi_DHM) %>% 
  filter(monthly_date < "2021-01-01")

Tantabiddi_13TNT_cum <- ggplot(Tantabiddi_13TNT_cum_HSdays) +
  geom_smooth(aes(x = monthly_date, y = DHM_months_count, color = Data_Type)) + 
  labs(x = "Time", y = "Cumulative high DHM months", title = "Tantabiddi 13TNT", color = "Data Type") 

Tantabiddi_13TNT_cum

#DHM >= 1
High_13TNT_DHM <- Tantabiddi_13TNT_Combined %>% 
  filter(`13TNT_DHM` >= 1) %>% 
  select(monthly_date, Reef_Site, Data_Type, `13TNT_DHM`) %>% 
  mutate(monthly_date = yearmonth(monthly_date)) %>% 
  pivot_wider(names_from = Data_Type, values_from = `13TNT_DHM`) %>% 
  arrange(-desc(monthly_date)) %>% 
  rename(Date = monthly_date, Site = Reef_Site)

#color.me <- which(High_13TNT_DHM$`Coral Core (CCI)`> 0 | High_13TNT_DHM$`Coral Core (NOAA)` >0)

#kbl(High_13TNT_DHM, longtable = T, caption = "Coral Core Date Range is from 2004 to 2013") %>% 
#  kable_styling(position = "center", latex_options = c("repeat_header")) %>% 
#  add_header_above(c(" " = 2, "Degree Heating Month Values in 13TNT" = 2), bold = TRUE) #%>% 
#  row_spec(color.me, color = "red")

#Visualising DHM values in CCI, NOAA, GCM and CCore 
`13TNT` <- Tantabiddi_13TNT_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2011-01-01")), xmax = as.Date(c("2012-01-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
    geom_rect(aes_string(xmin = as.Date(c("2016-01-01")), xmax = as.Date(c("2017-01-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("2010-06-01"), y = Inf, label = "2011", hjust = 1, vjust = 1, size = 4)+
  annotate("text", x = as.Date("2017-06-01"), y = Inf, label = "2016", hjust = 0, vjust = 1, size = 4)+
  geom_line(aes(x = monthly_date, y = `13TNT_DHM`, color = Data_Type), alpha = 0.5, size = 1) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "Time", y = "Degree Heating Month", title = "(f) 13TNT (-21.91, 113.97)", subtitle = "Ningaloo Reef")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "bottom",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  )

#Visualising in separate plots
Tantabiddi_13TNT_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
    geom_rect(aes_string(xmin = as.Date(c("2015-06-01")), xmax = as.Date(c("2017-06-01")),
                ymin = -Inf, ymax = Inf), color = "blue", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = `13TNT_DHM`, color = Data_Type), alpha = 0.5, size = 1.3) +
  labs(x = "Date", y = "Degree Heating Month", title = "13TNT Degree Heating Month values time plot")+
  scale_color_manual(values = cols) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank()
  ) +
  facet_wrap(~Tantabiddi_13TNT_Combined$Data_Type)

ggsave("Supp_13TNT_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)

```

\newpage
# **Houtman Abrolhos HAB05B** Degree Heating Months Time Series
```{r DHM_HAB05B, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
HAB05B_DHM <- rep(0,nrow(CCI_HAB05B))
HAB05B_negative_anomaly <- 0
for (i in 1:nrow(CCI_HAB05B)){
  if(CCI_HAB05B$anomaly[i] > 0) {
    HAB05B_negative_anomaly <- 
      HAB05B_negative_anomaly + CCI_HAB05B$anomaly[i]
  } else {
    HAB05B_negative_anomaly <- 0
  }
  HAB05B_DHM[i] <- HAB05B_negative_anomaly
}

CCI_HAB05B <- CCI_HAB05B %>% 
  add_column(HAB05B_DHM)

write_csv(CCI_HAB05B, here::here("data_raw/DHM/CCI_HAB05B_DHM.csv"))

#DHM calculations for NOAA dataset
HAB05B_DHM <- rep(0,nrow(NOAA_HAB05B))
HAB05B_negative_anomaly <- 0
for (i in 1:nrow(NOAA_HAB05B)){
  if(NOAA_HAB05B$anomaly[i] > 0) {
    HAB05B_negative_anomaly <- 
      HAB05B_negative_anomaly + NOAA_HAB05B$anomaly[i]
  } else {
    HAB05B_negative_anomaly <- 0
  }
  HAB05B_DHM[i] <- HAB05B_negative_anomaly
}

NOAA_HAB05B <- NOAA_HAB05B %>% 
  add_column(HAB05B_DHM)

write_csv(NOAA_HAB05B, here::here("data_raw/DHM/NOAA_HAB05B_DHM.csv"))

#DHM calculations for GCM dataset 
HAB05B_DHM <- rep(0,nrow(GCM_HAB05B))
HAB05B_negative_anomaly <- 0
for (i in 1:nrow(GCM_HAB05B)){
  if(GCM_HAB05B$anomaly[i] > 0) {
    HAB05B_negative_anomaly <- 
      HAB05B_negative_anomaly + GCM_HAB05B$anomaly[i]
  } else {
    HAB05B_negative_anomaly <- 0
  }
  HAB05B_DHM[i] <- HAB05B_negative_anomaly
}

GCM_HAB05B <- GCM_HAB05B %>% 
  add_column(HAB05B_DHM)

write_csv(GCM_HAB05B, here::here("data_raw/DHM/GCM_HAB05B_DHM.csv"))

#DHM calculations for Coral Core dataset
#excluded due to annual data resolution

#Combining datasets with DHM calculations
HAB05B_Combined <- rbind(CCI_HAB05B, NOAA_HAB05B, GCM_HAB05B)

#Cumulative Plot
HAB05B_cum_HSdays <- HAB05B_Combined %>% 
  select(monthly_date, Reef_Site, Data_Type, HAB05B_DHM) %>% 
  mutate(HAB05B_DHM = if_else(HAB05B_DHM > 1, 1, 0)) %>% 
  group_by(Data_Type) %>% 
  mutate(DHM_months_count = cumsum(HAB05B_DHM)) %>% 
  ungroup() %>% 
  select(-HAB05B_DHM) %>% 
  filter(monthly_date < "2021-01-01")

HAB05B_cum <- ggplot(HAB05B_cum_HSdays) +
  geom_smooth(aes(x = monthly_date, y = DHM_months_count, color = Data_Type)) + 
  labs(x = "Time", y = "Cumulative high DHM months", title = "HAB05B", color = "Data Type") 

HAB05B_cum

#DHM in descending order
#Max_DHM_CCI_HAB05B <- CCI_HAB05B %>% 
#  arrange(desc(HAB05B_DHM)) %>% 
#  select(date, HAB05B_DHM)
#Max_DHM_NOAA_HAB05B <- NOAA_HAB05B %>% 
#  arrange(desc(HAB05B_DHM)) %>% 
#  select(date, HAB05B_DHM)


#knitr::kable(list(Max_DHM_CCI_HAB05B, Max_DHM_NOAA_HAB05B), caption = "Degree Heating Month values in HAB05B from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
HAB05B <- HAB05B_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2011-01-01")), xmax = as.Date(c("2012-01-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("2012-06-01"), y = Inf, label = "2011", hjust = 0, vjust = 1, size = 4)+
  annotate(geom = "text", x = as.Date("2027-01-01"), y = Inf, label = "(S)CCI>NOAA>GCM", size = 3, vjust = 1)+
  geom_line(aes(x = monthly_date, y = HAB05B_DHM, color = Data_Type), alpha = 0.5, size = 1) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "Time", y = "Degree Heating Month", title = "(d) HAB05B (-28.46, 113.77)", subtitle = "Houtman Abrolhos")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "bottom",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  ) 

#Visualising in Separate Plots
HAB05B_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = HAB05B_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "Date", y = "Degree Heating Month", title = "HAB05B Degree Heating Month values time plot")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2), limits = c(0,10)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "bottom",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  ) +
  facet_wrap(~HAB05B_Combined$Data_Type)

ggsave("Supp_HAB05B_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)
 
```

\newpage
# **Houtman Abrolhos HAB10A** Degree Heating Months Time Series
```{r DHM_HAB10A, echo = FALSE, message = FALSE, warning = FALSE}


#DHM calculations for CCI dataset 
HAB10A_DHM <- rep(0,nrow(CCI_HAB10A))
HAB10A_negative_anomaly <- 0
for (i in 1:nrow(CCI_HAB10A)){
  if(CCI_HAB10A$anomaly[i] > 0) {
    HAB10A_negative_anomaly <- 
      HAB10A_negative_anomaly + CCI_HAB10A$anomaly[i]
  } else {
    HAB10A_negative_anomaly <- 0
  }
  HAB10A_DHM[i] <- HAB10A_negative_anomaly
}

CCI_HAB10A <- CCI_HAB10A %>% 
  add_column(HAB10A_DHM)

write_csv(CCI_HAB10A, here::here("data_raw/DHM/CCI_HAB10A_DHM.csv"))

#DHM calculations for NOAA dataset
HAB10A_DHM <- rep(0,nrow(NOAA_HAB10A))
HAB10A_negative_anomaly <- 0
for (i in 1:nrow(NOAA_HAB10A)){
  if(NOAA_HAB10A$anomaly[i] > 0) {
    HAB10A_negative_anomaly <- 
      HAB10A_negative_anomaly + NOAA_HAB10A$anomaly[i]
  } else {
    HAB10A_negative_anomaly <- 0
  }
  HAB10A_DHM[i] <- HAB10A_negative_anomaly
}

NOAA_HAB10A <- NOAA_HAB10A %>% 
  add_column(HAB10A_DHM)

write_csv(NOAA_HAB10A, here::here("data_raw/DHM/NOAA_HAB10A_DHM.csv"))

#DHM calculations for GCM dataset 
HAB10A_DHM <- rep(0,nrow(GCM_HAB10A))
HAB10A_negative_anomaly <- 0
for (i in 1:nrow(GCM_HAB10A)){
  if(GCM_HAB10A$anomaly[i] > 0) {
    HAB10A_negative_anomaly <- 
      HAB10A_negative_anomaly + GCM_HAB10A$anomaly[i]
  } else {
    HAB10A_negative_anomaly <- 0
  }
  HAB10A_DHM[i] <- HAB10A_negative_anomaly
}

GCM_HAB10A <- GCM_HAB10A %>% 
  add_column(HAB10A_DHM)

write_csv(GCM_HAB10A, here::here("data_raw/DHM/GCM_HAB10A_DHM.csv"))

#DHM calculations for Coral Core dataset
#excluded due to annual data resolution

#Combining datasets with DHM calculations
HAB10A_Combined <- rbind(CCI_HAB10A, NOAA_HAB10A, GCM_HAB10A)

#Cumulative Plot
HAB10A_cum_HSdays <- HAB10A_Combined %>% 
  select(monthly_date, Reef_Site, Data_Type, HAB10A_DHM) %>% 
  mutate(HAB10A_DHM = if_else(HAB10A_DHM > 1, 1, 0)) %>% 
  group_by(Data_Type) %>% 
  mutate(DHM_months_count = cumsum(HAB10A_DHM)) %>% 
  ungroup() %>% 
  select(-HAB10A_DHM) %>% 
  filter(monthly_date < "2021-01-01")

HAB10A_cum <- ggplot(HAB10A_cum_HSdays) +
  geom_smooth(aes(x = monthly_date, y = DHM_months_count, color = Data_Type)) + 
  labs(x = "Time", y = "Cumulative high DHM months", title = "HAB10A", color = "Data Type") 

HAB10A_cum

#DHM in descending order
#Max_DHM_CCI_HAB10A <- CCI_HAB10A %>% 
#  arrange(desc(HAB10A_DHM)) %>% 
#  select(date, HAB10A_DHM)
#Max_DHM_NOAA_HAB10A <- NOAA_HAB10A %>% 
#  arrange(desc(HAB10A_DHM)) %>% 
#  select(date, HAB10A_DHM)


#knitr::kable(list(Max_DHM_CCI_HAB10A, Max_DHM_NOAA_HAB10A), caption = "Degree Heating Month values in HAB10A from CCI (left) and NOAA (right)", col.names = c("Date", "DHM value"))

#Visualising DHM values in CCI, NOAA, GCM and CCore 
HAB10A <- HAB10A_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2011-01-01")), xmax = as.Date(c("2012-01-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  annotate("text", x = as.Date("2012-06-01"), y = Inf, label = "2011", hjust = 0, vjust = 1, size = 4)+
  annotate(geom = "text", x = as.Date("2027-01-01"), y = Inf, label = "(S)CCI>NOAA>GCM", size = 3, vjust = 1)+
  geom_line(aes(x = monthly_date, y = HAB10A_DHM, color = Data_Type), alpha = 0.5, size = 1) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "", y = "Degree Heating Month", title = "(c) HAB10A (-28.46, 113.75)", subtitle = "Houtman Abrolhos")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "none",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  )  

#Visualising in separate plots
HAB10A_Combined %>% 
  ggplot()+
  geom_rect(aes_string(xmin = as.Date(c("2010-06-01")), xmax = as.Date(c("2012-06-01")),
                ymin = -Inf, ymax = Inf), color = "maroon", fill = "transparent", alpha = 0.5)+
  geom_line(aes(x = monthly_date, y = HAB10A_DHM, color = Data_Type), alpha = 0.5, size = 1.3) +
  scale_x_date(limits = as_date(c("1985-01-01","2030-01-01")))+
  labs(x = "Date", y = "Degree Heating Month", title = "HAB10A Degree Heating Month values time plot")+
  scale_color_manual(values = cols_no_cc) +
  scale_y_continuous(breaks = c(0, 1, 2), limits = c(0,10)) +
  theme(panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        legend.key = element_rect(fill = "transparent"),
        plot.title = element_text(face = "bold", size = 12),
        axis.title = element_text(size = 12),
        legend.position = "bottom",
        panel.background = element_blank(),
        axis.line = element_line(color = "grey"),
        legend.direction = "horizontal",
        legend.title = element_blank()
  )  +
  facet_wrap(~HAB10A_Combined$Data_Type)

ggsave("Supp_HAB10A_DHM.png", path = here::here("graphics/Figures"), dpi = 300, scale = 3, limitsize = FALSE)

 
```

#**Cumulative Plots**
```{r Cumulative_Plots, echo = FALSE, warning = FALSE, message = FALSE}

Cumulative_DHM <- (BRS07_cum + DARL_cum) / (SCOTT_RPO_1_cum + SCOTTSL1_cum) /
  (Tantabiddi_08TNT_cum + Tantabiddi_13TNT_cum) / (Bundegi_08BND_cum + Bundegi_13BND_cum) /
  (HAB05B_cum + HAB10A_cum)

Cumulative_DHM

ggsave("Cumulative_DHM.png", path = here::here("graphics/Figures"), dpi = 300, width = 210, height = 297, units = "mm", limitsize = FALSE)

```


\newpage
# **Combined Plots with Coral Core Data**
```{r Combined_Sites_with_Coral, echo = FALSE, fig.width = 15, fig.height = 8}

DARL / BRS07 / `08BND` 
ggsave("DHM01.png", path = here::here("graphics/Figures"), dpi = 300, width = 210, height = 279, units = "mm", limitsize = FALSE)


`13BND` / `08TNT` / `13TNT`
ggsave("DHM02.png", path = here::here("graphics/Figures"), dpi = 300, width = 210, height = 279, units = "mm", limitsize = FALSE)


```

\newpage
# **Combined Plots without Coral Core Data**
```{r Combined_Sites_without_Coral, echo = FALSE, fig.width= 15, fig.height = 8}

SCOTT_RPO_1 / SCOTTSL1 / HAB10A / HAB05B
ggsave("DHM03.png", path = here::here("graphics/Figures"), dpi = 300, width = 210, height = 279, units = "mm", limitsize = FALSE)


```


```{r Frequency_Tables, echo = FALSE, message = FALSE, include = FALSE}
#DAR Long
freq_mod_DHM_DARL <- DARL_Combined %>% 
  select(monthly_date, DARL_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = DARL_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "DAR Long", Reef = "Cocos Keeling Island")

freq_sev_DHM_DARL <- DARL_Combined %>% 
  select(monthly_date, DARL_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = DARL_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "DAR Long", Reef = "Cocos Keeling Island")

#BRS07
freq_mod_DHM_BRS07 <- BRS07_Combined %>% 
  select(monthly_date, BRS07_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = BRS07_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "BRS07", Reef = "Browse Island")

freq_sev_DHM_BRS07 <- BRS07_Combined %>% 
  select(monthly_date, BRS07_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = BRS07_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "BRS07", Reef = "Browse Island")

#08BND
freq_mod_DHM_Bundegi_08BND <- Bundegi_08BND_Combined %>% 
  select(monthly_date, Bundegi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Bundegi_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "08BND", Reef = "Ningaloo Reef")

freq_sev_DHM_Bundegi_08BND <- Bundegi_08BND_Combined %>% 
  select(monthly_date, Bundegi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Bundegi_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "08BND", Reef = "Ningaloo Reef")

#13BND
freq_mod_DHM_Bundegi_13BND <- Bundegi_13BND_Combined %>% 
  select(monthly_date, Bundegi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Bundegi_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "13BND", Reef = "Ningaloo Reef")

freq_sev_DHM_Bundegi_13BND <- Bundegi_13BND_Combined %>% 
  select(monthly_date, Bundegi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Bundegi_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "13BND", Reef = "Ningaloo Reef")

#08TNT
freq_mod_DHM_Tantabiddi_08TNT <- Tantabiddi_08TNT_Combined %>% 
  select(monthly_date, Tantabiddi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Tantabiddi_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "08TNT", Reef = "Ningaloo Reef")

freq_sev_DHM_Tantabiddi_08TNT <- Tantabiddi_08TNT_Combined %>% 
  select(monthly_date, Tantabiddi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Tantabiddi_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "08TNT", Reef = "Ningaloo Reef")

#13TNT
freq_mod_DHM_Tantabiddi_13TNT <- Tantabiddi_13TNT_Combined %>% 
  select(monthly_date, `13TNT_DHM`, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = `13TNT_DHM`) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "13TNT", Reef = "Ningaloo Reef")

freq_sev_DHM_Tantabiddi_13TNT <- Tantabiddi_13TNT_Combined %>% 
  select(monthly_date, `13TNT_DHM`, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = `13TNT_DHM`) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM, `Coral Core (CCI)`, `Coral Core (NOAA)`), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "13TNT", Reef = "Ningaloo Reef")

#SCOTT_RPO_1
freq_mod_DHM_SCOTT_RPO_1 <- SCOTT_RPO_1_Combined %>% 
  select(monthly_date, SCOTT_RPO_1_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = SCOTT_RPO_1_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "SCOTT_RPO_1", Reef = "Scott Reef")

freq_sev_DHM_SCOTT_RPO_1 <- SCOTT_RPO_1_Combined %>% 
  select(monthly_date, SCOTT_RPO_1_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = SCOTT_RPO_1_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "SCOTT_RPO_1", Reef = "Scott Reef")

#SCOTTSL1
freq_mod_DHM_SCOTTSL1 <- SCOTTSL1_Combined %>% 
  select(monthly_date, SCOTTSL1_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = SCOTTSL1_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "SCOTTSL1", Reef = "Scott Reef")

freq_sev_DHM_SCOTTSL1 <- SCOTTSL1_Combined %>% 
  select(monthly_date, SCOTTSL1_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = SCOTTSL1_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "SCOTTSL1", Reef = "Scott Reef")

#HAB10A
freq_mod_DHM_HAB10A <- HAB10A_Combined %>% 
  select(monthly_date, HAB10A_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = HAB10A_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "HAB10A", Reef = "Houtman Abrolhos")

freq_sev_DHM_HAB10A <- HAB10A_Combined %>% 
  select(monthly_date, HAB10A_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = HAB10A_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "HAB10A", Reef = "Houtman Abrolhos")

#HAB05B
freq_mod_DHM_HAB05B <- HAB05B_Combined %>% 
  select(monthly_date, HAB05B_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = HAB05B_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "HAB05B", Reef = "Houtman Abrolhos")

freq_sev_DHM_HAB05B <- HAB05B_Combined %>% 
  select(monthly_date, HAB05B_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = HAB05B_DHM) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "HAB05B", Reef = "Houtman Abrolhos")

#summary
freq_mod_DHM_withCC_combined <- rbind(freq_mod_DHM_DARL, freq_mod_DHM_BRS07, freq_mod_DHM_Bundegi_08BND, freq_mod_DHM_Bundegi_13BND, freq_mod_DHM_Tantabiddi_08TNT, freq_mod_DHM_Tantabiddi_13TNT) %>% 
  relocate(c(4, 3)) %>% 
  complete(nesting(`Reef`, `Site`), `Data Type`, 
           fill = list(`moderate bleaching days` = 0))

freq_mod_DHM_noCC_combined <- rbind(freq_mod_DHM_SCOTT_RPO_1, freq_mod_DHM_SCOTTSL1, freq_mod_DHM_HAB10A, freq_mod_DHM_HAB05B) %>% 
  relocate(c(4, 3)) %>% 
  complete(nesting(`Reef`, `Site`), `Data Type`, 
           fill = list(`moderate bleaching days` = 0))

freq_sev_DHM_withCC_combined <- rbind(freq_sev_DHM_DARL, freq_sev_DHM_BRS07, freq_sev_DHM_Bundegi_08BND, freq_sev_DHM_Bundegi_13BND, freq_sev_DHM_Tantabiddi_08TNT, freq_sev_DHM_Tantabiddi_13TNT) %>% 
  relocate(c(4, 3)) %>% 
  complete(nesting(`Reef`, `Site`), `Data Type`, 
           fill = list(`severe bleaching days` = 0))

freq_sev_DHM_noCC_combined <- rbind(freq_sev_DHM_SCOTT_RPO_1, freq_sev_DHM_SCOTTSL1, freq_sev_DHM_HAB10A, freq_sev_DHM_HAB05B) %>% 
  relocate(c(4, 3)) %>% 
  complete(nesting(`Reef`, `Site`), `Data Type`, 
           fill = list(`severe bleaching days` = 0))

#data is truncated when Coral core date range is incorporated
#analysis of CCI, NOAA and GCM only (1985-2020)
#without Coral Core date range
#DAR Long
freq_mod_DHM_DARL <- DARL_Combined %>% 
  select(monthly_date, DARL_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = DARL_DHM) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "DAR Long", Reef = "Cocos Keeling Island")

freq_sev_DHM_DARL <- DARL_Combined %>% 
  select(monthly_date, DARL_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = DARL_DHM) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "DAR Long", Reef = "Cocos Keeling Island")

#BRS07
freq_mod_DHM_BRS07 <- BRS07_Combined %>% 
  select(monthly_date, BRS07_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = BRS07_DHM) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "BRS07", Reef = "Browse Island")

freq_sev_DHM_BRS07 <- BRS07_Combined %>% 
  select(monthly_date, BRS07_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = BRS07_DHM) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "BRS07", Reef = "Browse Island")

#08BND
freq_mod_DHM_Bundegi_08BND <- Bundegi_08BND_Combined %>% 
  select(monthly_date, Bundegi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Bundegi_DHM) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "08BND", Reef = "Ningaloo Reef")

freq_sev_DHM_Bundegi_08BND <- Bundegi_08BND_Combined %>% 
  select(monthly_date, Bundegi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Bundegi_DHM) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "08BND", Reef = "Ningaloo Reef")

#13BND
freq_mod_DHM_Bundegi_13BND <- Bundegi_13BND_Combined %>% 
  select(monthly_date, Bundegi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Bundegi_DHM) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "13BND", Reef = "Ningaloo Reef")

freq_sev_DHM_Bundegi_13BND <- Bundegi_13BND_Combined %>% 
  select(monthly_date, Bundegi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Bundegi_DHM) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "13BND", Reef = "Ningaloo Reef")

#08TNT
freq_mod_DHM_Tantabiddi_08TNT <- Tantabiddi_08TNT_Combined %>% 
  select(monthly_date, Tantabiddi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Tantabiddi_DHM) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "08TNT", Reef = "Ningaloo Reef")

freq_sev_DHM_Tantabiddi_08TNT <- Tantabiddi_08TNT_Combined %>% 
  select(monthly_date, Tantabiddi_DHM, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = Tantabiddi_DHM) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "08TNT", Reef = "Ningaloo Reef")

#13TNT
freq_mod_DHM_Tantabiddi_13TNT <- Tantabiddi_13TNT_Combined %>% 
  select(monthly_date, `13TNT_DHM`, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = `13TNT_DHM`) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 1 & DHM < 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`moderate bleaching days` = n()) %>% 
  mutate(Site = "13TNT", Reef = "Ningaloo Reef")

freq_sev_DHM_Tantabiddi_13TNT <- Tantabiddi_13TNT_Combined %>% 
  select(monthly_date, `13TNT_DHM`, Data_Type) %>% 
  pivot_wider(names_from = Data_Type, values_from = `13TNT_DHM`) %>% 
  select(-c(`Coral Core (CCI)`, `Coral Core (NOAA)`)) %>% 
  na.omit() %>% 
  pivot_longer(cols = c(CCI, NOAA, GCM), names_to = "Data Type", values_to = "DHM") %>% 
  filter(DHM >= 2) %>% 
  group_by(`Data Type`) %>% 
  summarize(`severe bleaching days` = n()) %>% 
  mutate(Site = "13TNT", Reef = "Ningaloo Reef")

#summary without CCore
freq_mod_DHM_combined_CCore_rm <- rbind(freq_mod_DHM_DARL, freq_mod_DHM_BRS07, freq_mod_DHM_Bundegi_08BND, freq_mod_DHM_Bundegi_13BND, freq_mod_DHM_Tantabiddi_08TNT, freq_mod_DHM_Tantabiddi_13TNT) %>% 
  relocate(c(4, 3)) %>% 
  complete(nesting(`Reef`, `Site`), `Data Type`, 
           fill = list(`moderate bleaching days` = 0))

freq_sev_DHM_combined_CCore_rm <- rbind(freq_sev_DHM_DARL, freq_sev_DHM_BRS07, freq_sev_DHM_Bundegi_08BND, freq_sev_DHM_Bundegi_13BND, freq_sev_DHM_Tantabiddi_08TNT, freq_sev_DHM_Tantabiddi_13TNT) %>% 
  relocate(c(4, 3)) %>% 
  complete(nesting(`Reef`, `Site`), `Data Type`, 
           fill = list(`severe bleaching days` = 0))



```

```{r Chi_Sq_test_noCC, echo = FALSE, include = FALSE}
DHM_Mod_noCC_Chi_Sq <- map_df(unique(freq_mod_DHM_noCC_combined$Site),   
    ~ chisq.test(freq_mod_DHM_noCC_combined %>% 
      filter(Site == .x) %>% 
      pull(`moderate bleaching days`)) %>% 
      broom::tidy()
    ) %>% 
  mutate(Site = unique(freq_mod_DHM_noCC_combined$Site)) %>% 
  relocate(Site) %>% 
  select(Site, p.value)

DHM_Sev_noCC_Chi_Sq <- map_df(unique(freq_sev_DHM_noCC_combined$Site),   
    ~ chisq.test(freq_sev_DHM_noCC_combined %>% 
      filter(Site == .x) %>% 
      pull(`severe bleaching days`)) %>% 
      broom::tidy()
    ) %>% 
  mutate(Site = unique(freq_sev_DHM_noCC_combined$Site)) %>% 
  relocate(Site) %>% 
  select(Site, p.value)

#Plotting tables with Chi-Sq p-value
freq_mod_DHM_noCC_ChiSq <- freq_mod_DHM_noCC_combined %>% 
  pivot_wider(names_from = "Data Type", values_from = "moderate bleaching days") %>% 
  left_join(DHM_Mod_noCC_Chi_Sq, by = "Site") %>% 
  rename(`Chi-Square p-value` = p.value)

freq_sev_DHM_noCC_ChiSq <- freq_sev_DHM_noCC_combined %>% 
  pivot_wider(names_from = "Data Type", values_from = "severe bleaching days") %>% 
  left_join(DHM_Sev_noCC_Chi_Sq, by = "Site") %>% 
  rename(`Chi-Square p-value` = p.value)

write_csv(freq_mod_DHM_noCC_ChiSq, here::here("R/DHM_mod_noCC_ChiSq.csv"))
write_csv(freq_sev_DHM_noCC_ChiSq, here::here("R/DHM_sev_noCC_ChiSq.csv"))

```


```{r Chi_Sq_test_withCC_all, echo = FALSE, include = FALSE}
DHM_Mod_withCC_Chi_Sq <- map_df(unique(freq_mod_DHM_withCC_combined$Site),   
    ~ chisq.test(freq_mod_DHM_withCC_combined %>% 
      filter(Site == .x) %>% 
      pull(`moderate bleaching days`)) %>% 
      broom::tidy()
    ) %>% 
  mutate(Site = unique(freq_mod_DHM_withCC_combined$Site)) %>% 
  relocate(Site) %>% 
  select(Site, p.value)

DHM_Sev_withCC_Chi_Sq <- map_df(unique(freq_sev_DHM_withCC_combined$Site),   
    ~ chisq.test(freq_sev_DHM_withCC_combined %>% 
      filter(Site == .x) %>% 
      pull(`severe bleaching days`)) %>% 
      broom::tidy()
    ) %>% 
  mutate(Site = unique(freq_sev_DHM_withCC_combined$Site)) %>% 
  relocate(Site) %>% 
  select(Site, p.value)

#Plotting tables with Chi-Sq p-value
freq_mod_DHM_withCC_ChiSq <- freq_mod_DHM_withCC_combined %>% 
  pivot_wider(names_from = "Data Type", values_from = "moderate bleaching days") %>% 
  left_join(DHM_Mod_withCC_Chi_Sq, by = "Site") %>% 
  rename(`Chi-Square p-value` = p.value)

freq_sev_DHM_withCC_ChiSq <- freq_sev_DHM_withCC_combined %>% 
  pivot_wider(names_from = "Data Type", values_from = "severe bleaching days") %>% 
  left_join(DHM_Sev_withCC_Chi_Sq, by = "Site") %>% 
  rename(`Chi-Square p-value` = p.value)

write_csv(freq_mod_DHM_withCC_ChiSq, here::here("R/DHM_mod_withCC_ChiSq.csv"))
write_csv(freq_sev_DHM_withCC_ChiSq, here::here("R/DHM_sev_withCC_ChiSq.csv"))

```


```{r Chi_Sq_test_withCC_CCore_rm, echo = FALSE, include = FALSE}
DHM_Mod_withCC_CCore_rm_Chi_Sq <- map_df(unique(freq_mod_DHM_combined_CCore_rm$Site),   
    ~ chisq.test(freq_mod_DHM_combined_CCore_rm %>% 
      filter(Site == .x) %>% 
      pull(`moderate bleaching days`)) %>% 
      broom::tidy()
    ) %>% 
  mutate(Site = unique(freq_mod_DHM_combined_CCore_rm$Site)) %>% 
  relocate(Site) %>% 
  select(Site, p.value)

DHM_Sev_withCC_CCore_rm_Chi_Sq <- map_df(unique(freq_sev_DHM_combined_CCore_rm$Site),   
    ~ chisq.test(freq_sev_DHM_combined_CCore_rm %>% 
      filter(Site == .x) %>% 
      pull(`severe bleaching days`)) %>% 
      broom::tidy()
    ) %>% 
  mutate(Site = unique(freq_sev_DHM_combined_CCore_rm$Site)) %>% 
  relocate(Site) %>% 
  select(Site, p.value)

#Plotting tables with Chi-Sq p-value
freq_mod_DHM_withCC_CCore_rm_ChiSq <- freq_mod_DHM_combined_CCore_rm %>% 
  pivot_wider(names_from = "Data Type", values_from = "moderate bleaching days") %>% 
  left_join(DHM_Mod_withCC_CCore_rm_Chi_Sq, by = "Site") %>% 
  rename(`Chi-Square p-value` = p.value)

freq_sev_DHM_withCC_CCore_rm_ChiSq <- freq_sev_DHM_combined_CCore_rm %>% 
  pivot_wider(names_from = "Data Type", values_from = "severe bleaching days") %>% 
  left_join(DHM_Sev_withCC_CCore_rm_Chi_Sq, by = "Site") %>% 
  rename(`Chi-Square p-value` = p.value)

write_csv(freq_mod_DHM_withCC_CCore_rm_ChiSq, here::here("R/DHM_mod_withCC_CCore_rm_ChiSq.csv"))
write_csv(freq_sev_DHM_withCC_CCore_rm_ChiSq, here::here("R/DHM_sev_withCC_CCore_rm_ChiSq.csv"))

```
